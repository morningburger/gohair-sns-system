<!DOCTYPE html>
<html lang="ko">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- GitHub Pages Base -->
<base href="https://snshub.kr/">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- ğŸ”¥ Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
    <div id="connectionStatus" class="connection-status connected">ğŸŸ¢ Firebase ì—°ê²°ë¨</div>

    <!-- ë¡œê·¸ì¸ í˜ì´ì§€ -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-form">
                <div class="logo">
                    <h1>GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                    <p>SNS ë¦¬ë” ë¡œê·¸ì¸</p>
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <label>ğŸ“§ ì´ë©”ì¼</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label>ğŸ”’ ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">ğŸ”‘ ë¡œê·¸ì¸</button>
                </form>
<div class="text-center" style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.5rem;">
<a href="#" onclick="debugPasswordReset()" style="color: #dc2626; text-decoration: none; font-size: 0.875rem;">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</a>
    <a href="#" onclick="showSignup()" style="color: #6366f1; text-decoration: none; font-size: 0.875rem;">SNS ë¦¬ë”ë¡œ ê°€ì…í•˜ê¸°</a>
</div>
            </div>
        </div>
    </div>

    <!-- ê°€ì… í˜ì´ì§€ -->
    <div id="signupPage" class="hidden">
        <div class="login-container">
            <div class="login-form">
                <div class="logo">
                    <h1>SNS ë¦¬ë” ê°€ì…</h1>
                    <p>ìƒˆë¡œìš´ SNS ë¦¬ë” ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤</p>
                </div>
<form id="signupForm">
    <div class="form-group">
        <label>ğŸ‘¤ ì´ë¦„</label>
        <input type="text" id="signupName" required>
    </div>
    <div class="form-group">
        <label>ğŸ·ï¸ ì§ê¸‰</label>
        <select id="signupPosition" required>
            <option value="">ì§ê¸‰ì„ ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì¸í„´">ì¸í„´</option>
            <option value="ë””ìì´ë„ˆ">ë””ìì´ë„ˆ</option>
            <option value="íŒ€ì¥">íŒ€ì¥</option>
            <option value="ì‹¤ì¥">ì‹¤ì¥</option>
            <option value="ë¶€ì›ì¥">ë¶€ì›ì¥</option>
            <option value="ì›ì¥">ì›ì¥</option>
        </select>
    </div>
    <div class="form-group">
        <label>ğŸ“§ ì´ë©”ì¼</label>
        <input type="email" id="signupEmail" required>
    </div>
    <div class="form-group">
        <label>ğŸ”’ ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="signupPassword" required minlength="6">
        <small style="color: #6b7280; font-size: 0.8rem;">ìµœì†Œ 6ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”</small>
    </div>
    <div class="form-group">
        <label>ğŸ”’ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        <input type="password" id="signupPasswordConfirm" required minlength="6">
        <small id="passwordMatchMessage" style="font-size: 0.8rem;"></small>
    </div>
    <div class="form-group">
        <label>ğŸ¢ ì§€ì  ì„ íƒ</label>
        <select id="signupBranch" required>
            <option value="">ì§€ì ì„ ì„ íƒí•˜ì„¸ìš”</option>
        </select>
<div id="branchLoadingStatus" style="margin-top: 0.5rem; font-size: 0.875rem; color: #6b7280;">
        ğŸ”„ ì§€ì  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>
                    <button type="submit" class="btn" style="width: 100%;">â• ê°€ì…í•˜ê¸°</button>
                </form>
<div class="text-center" style="margin-top: 1rem;">
    <a href="#" onclick="showLogin()" style="color: #6366f1; text-decoration: none; font-size: 0.875rem;">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸í•˜ê¸°</a>
</div>
            </div>
        </div>
    </div>
<!-- ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í˜ì´ì§€ -->
    <div id="passwordResetPage" class="hidden">
        <div class="login-container">
            <div class="login-form">
                <div class="logo">
                    <h1>ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h1>
                    <p>ë“±ë¡ëœ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”</p>
                </div>
                <form id="passwordResetForm">
                    <div class="form-group">
                        <label>ğŸ“§ ì´ë©”ì¼</label>
                        <input type="email" id="resetEmail" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">ğŸ” ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
                </form>
                <div class="text-center" style="margin-top: 1rem;">
                    <a href="#" onclick="showLogin()" style="color: #6366f1; text-decoration: none; font-size: 0.875rem;">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ -->
    <div id="changePasswordModal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="text-lg font-bold">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
                <button onclick="hideChangePassword()" class="modal-close">âŒ</button>
            </div>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label>ğŸ”’ í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="currentPassword" required>
                </div>
                <div class="form-group">
                    <label>ğŸ”’ ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="newPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>ğŸ”’ ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="newPasswordConfirm" required minlength="6">
                    <small id="newPasswordMatchMessage" style="font-size: 0.8rem;"></small>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="hideChangePassword()" class="btn btn-secondary">âŒ ì·¨ì†Œ</button>
                    <button type="submit" class="btn">ğŸ’¾ ë³€ê²½</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ë©”ì¸ ì‹œìŠ¤í…œ (ëŒ€ì‹œë³´ë“œë§Œ) -->
    <div id="mainSystem" class="hidden">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="header-content">
                <div class="header-top">
                    <h1>GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
<div class="header-actions">
    <span id="currentUser" style="color: #6b7280; font-size: 0.875rem; padding: 0.5rem;"></span>
    <button onclick="showChangePassword()" class="btn" style="background-color: #8b5cf6;">
        ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    </button>
    <button onclick="exportData()" class="btn btn-green">
        ğŸ“¥ ë‚´ë³´ë‚´ê¸°
    </button>
    <button onclick="importData()" class="btn">
        ğŸ“¤ ê°€ì ¸ì˜¤ê¸°
    </button>
    <button onclick="logout()" class="btn btn-red">
        ğŸšª ë¡œê·¸ì•„ì›ƒ
    </button>
</div>
                </div>
                <nav class="nav">
                    <button class="nav-btn active">
                        ğŸ  ëŒ€ì‹œë³´ë“œ
                    </button>
                    <button onclick="goToPage('designers')" class="nav-btn">
                        ğŸ‘¥ ë””ìì´ë„ˆ ê´€ë¦¬
                    </button>
                    <button onclick="goToPage('branches')" class="nav-btn admin-only hidden">
                        ğŸ¢ ì§€ì  ê´€ë¦¬
                    </button>
                    <button onclick="goToPage('history')" class="nav-btn">
                        ğŸ“ˆ ë””ìì´ë„ˆ íˆìŠ¤í† ë¦¬
                    </button>
                    <button onclick="goToPage('checklist')" class="nav-btn">
                        ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì…ë ¥
                    </button>
                    <button onclick="goToPage('statistics')" class="nav-btn">
                        ğŸ“Š í†µê³„ ë¶„ì„
                    </button>
<button onclick="goToPage('comparison')" class="nav-btn admin-only">
    âš–ï¸ ì§€ì  ë¹„êµ
</button>
                </nav>
            </div>
        </header>

        <main class="container">
            <!-- ëŒ€ì‹œë³´ë“œ (ë©”ì¸ í˜ì´ì§€) -->
            <div id="dashboardPage">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-4">ğŸ  ëŒ€ì‹œë³´ë“œ</h2>
                    
                    <!-- ê¸°ê°„ í•„í„° ì¶”ê°€ -->
                    <div class="filter-controls">
                        <div class="grid grid-cols-4 gap-4">
                            <div>
                                <label class="font-medium">ğŸ“… ê¸°ê°„ ì„ íƒ</label>
                                <select id="dashboardPeriod" onchange="loadDashboard()">
                                    <option value="today">ì˜¤ëŠ˜</option>
                                    <option value="week">ì´ë²ˆ ì£¼</option>
                                    <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                                    <option value="all">ì „ì²´</option>
                                    <option value="custom">ì‚¬ìš©ì ì •ì˜</option>
                                </select>
                            </div>
                            <div id="dashboardCustomRange" class="hidden grid grid-cols-2 gap-4" style="grid-column: span 2;">
                                <div>
                                    <label class="font-medium">ì‹œì‘ì¼</label>
                                    <input type="date" id="dashboardStartDate" onchange="loadDashboard()">
                                </div>
                                <div>
                                    <label class="font-medium">ì¢…ë£Œì¼</label>
                                    <input type="date" id="dashboardEndDate" onchange="loadDashboard()">
                                </div>
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button onclick="loadDashboard()" class="btn" style="height: fit-content;">
                                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalReviews">0</div>
                        <div class="stat-label">â­ ë„¤ì´ë²„ ë¦¬ë·°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPosts">0</div>
                        <div class="stat-label">ğŸ“ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalExperience">0</div>
                        <div class="stat-label">ğŸ¯ ì²´í—˜ë‹¨ ìš´ì˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalReels">0</div>
                        <div class="stat-label">ğŸ¬ ì¸ìŠ¤íƒ€ ë¦´ìŠ¤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPhotos">0</div>
                        <div class="stat-label">ğŸ“· ì¸ìŠ¤íƒ€ ì‚¬ì§„</div>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 class="text-xl font-bold">ì§€ì ë³„ ì„±ê³¼ ìˆœìœ„</h3>
                        <button onclick="exportRankings()" class="btn btn-green">ğŸ“¥ ìˆœìœ„ ë‚´ë³´ë‚´ê¸°</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ìˆœìœ„</th>
                                    <th>ì§€ì </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('reviews')">
                                        â­ ë¦¬ë·° ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('posts')">
                                        ğŸ“ í¬ìŠ¤íŒ… ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('experience')">
                                        ğŸ¯ ì²´í—˜ë‹¨ ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('reels')">
                                        ğŸ¬ ë¦´ìŠ¤ ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('photos')">
                                        ğŸ“· ì‚¬ì§„ ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('total')">
                                        ì´í•© ğŸ”€
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="branchRankings">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

<!-- JavaScript Files (ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ) -->
<script src="js/config/firebase.js"></script>
<script src="js/utils/data-manager.js"></script>
<script src="js/utils/auth.js"></script>
<script src="js/utils/ui-utils.js"></script>
<!-- main.jsëŠ” ë‚˜ì¤‘ì— ë¡œë“œ -->
<script>
// ì´ˆê¸°í™” ì™„ë£Œ í›„ main.js ë¡œë“œ
document.addEventListener('DOMContentLoaded', function() {
    const script = document.createElement('script');
    script.src = 'js/main.js';
    document.head.appendChild(script);
});
</script>
    
    <!-- í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ -->
<script>
function goToPage(pageId) {
    console.log('í˜ì´ì§€ ì´ë™ ì‹œë„:', pageId);
    
    // index.htmlì—ì„œ pages í´ë”ë¡œ ì´ë™ (ê²½ë¡œ ìˆ˜ì •!)
    const pages = {
        'designers': 'pages/designers.html',
        'branches': 'pages/branches.html', 
        'history': 'pages/history.html',
        'checklist': 'pages/checklist.html', 
        'statistics': 'pages/statistics.html',
        'comparison': 'pages/comparison.html'
    };
    
    if (pages[pageId]) {
        console.log('ì´ë™í•  ê²½ë¡œ:', pages[pageId]);
        window.location.href = pages[pageId];
    } else {
        console.error('ì•Œ ìˆ˜ ì—†ëŠ” í˜ì´ì§€:', pageId);
    }
}

    async function loadBranchesForSignup() {
    try {
        console.log('ğŸ¢ ê°€ì…ìš© ì§€ì  ëª©ë¡ ë¡œë“œ ì‹œì‘');
        
        // Firebase ì—°ê²° í™•ì¸
        if (typeof firebase === 'undefined' || !firebase.apps.length) {
            throw new Error('Firebaseê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
        }
        
        const db = firebase.firestore();
        const branchesSnapshot = await db.collection('branches').orderBy('name').get();
        
        const signupBranchSelect = document.getElementById('signupBranch');
        const loadingStatus = document.getElementById('branchLoadingStatus');
        
        if (branchesSnapshot.empty) {
            console.log('âš ï¸ ë“±ë¡ëœ ì§€ì ì´ ì—†ìŠµë‹ˆë‹¤');
            loadingStatus.innerHTML = 'âš ï¸ ë“±ë¡ëœ ì§€ì ì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
            loadingStatus.style.color = '#dc2626';
            return;
        }
        
        // ê¸°ë³¸ ì˜µì…˜ ìœ ì§€í•˜ê³  Firebase ì§€ì ë“¤ ì¶”ê°€
        let optionsHTML = '<option value="">ì§€ì ì„ ì„ íƒí•˜ì„¸ìš”</option>';
        
        branchesSnapshot.docs.forEach(doc => {
            const branchData = doc.data();
            const branchName = branchData.name || branchData.branchName || doc.id;
            optionsHTML += `<option value="${branchName}">${branchName}</option>`;
        });
        
        signupBranchSelect.innerHTML = optionsHTML;
        
        loadingStatus.innerHTML = `âœ… ${branchesSnapshot.size}ê°œ ì§€ì  ë¡œë“œ ì™„ë£Œ`;
        loadingStatus.style.color = '#059669';
        
        // 3ì´ˆ í›„ ë¡œë”© ë©”ì‹œì§€ ìˆ¨ê¹€
        setTimeout(() => {
            loadingStatus.style.display = 'none';
        }, 3000);
        
        console.log(`âœ… ${branchesSnapshot.size}ê°œ ì§€ì  ë¡œë“œ ì™„ë£Œ`);
        
    } catch (error) {
        console.error('âŒ ì§€ì  ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        
        const loadingStatus = document.getElementById('branchLoadingStatus');
        if (loadingStatus) {
            loadingStatus.innerHTML = 'âŒ ì§€ì  ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
            loadingStatus.style.color = '#dc2626';
        }
    }
}

// ê°€ì… í˜ì´ì§€ í‘œì‹œ í•¨ìˆ˜ ìˆ˜ì •
function showSignup() {
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('signupPage').classList.remove('hidden');
    
    // ê°€ì… í˜ì´ì§€ê°€ í‘œì‹œë  ë•Œ ì§€ì  ëª©ë¡ ë¡œë“œ
    setTimeout(() => {
        loadBranchesForSignup();
    }, 100);
}



// Firebase ì—°ê²° í™•ì¸ í›„ ì§€ì  ë¡œë“œ ì¤€ë¹„
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ Firebase ì§€ì  ì—°ë™ ì¤€ë¹„ ì™„ë£Œ');
});

// ë¹„ë°€ë²ˆí˜¸ ê´€ë ¨ í•¨ìˆ˜ë“¤ (showPasswordReset ì œê±°)
function showChangePassword() {
    document.getElementById('changePasswordModal').classList.remove('hidden');
}

function hideChangePassword() {
    document.getElementById('changePasswordModal').classList.add('hidden');
    document.getElementById('changePasswordForm').reset();
    document.getElementById('newPasswordMatchMessage').textContent = '';
}

// showLogin í•¨ìˆ˜ ìˆ˜ì • (ê¸°ì¡´ í•¨ìˆ˜ ëŒ€ì²´)
function showLogin() {
    document.getElementById('signupPage').classList.add('hidden');
    document.getElementById('passwordResetPage').classList.add('hidden');
    document.getElementById('loginPage').classList.remove('hidden');
}
    // ë””ë²„ê¹…ìš© í•¨ìˆ˜ (ì„ì‹œ)
function debugPasswordReset() {
    console.log('ë””ë²„ê¹…: showPasswordReset í˜¸ì¶œë¨');
    
    // ê°•ì œë¡œ í˜ì´ì§€ ì „í™˜ (ê°„ë‹¨í•œ ë°©ë²•)
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('signupPage').classList.add('hidden');
    document.getElementById('passwordResetPage').classList.remove('hidden');
    
    console.log('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í˜ì´ì§€ í‘œì‹œ ì™„ë£Œ');
}
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê°•ì œ ì„¸ì…˜ ì²´í¬
window.addEventListener('load', function() {
    setTimeout(() => {
        const userData = sessionStorage.getItem('currentUser');
        if (userData) {
            console.log('ì„¸ì…˜ ë°ì´í„° ë°œê²¬, ë©”ì¸ ì‹œìŠ¤í…œ í‘œì‹œ');
            const loginPage = document.getElementById('loginPage');
            const mainSystem = document.getElementById('mainSystem');
            
            if (loginPage) loginPage.classList.add('hidden');
            if (mainSystem) mainSystem.classList.remove('hidden');
        }
    }, 500);
});
</script>
</body>
</html>
