<!DOCTYPE html>
<html lang="ko">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IG SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- GitHub Pages Base -->
    <base href="https://snshub.kr/">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- ğŸ”¥ Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- ì—°ê²° ìƒíƒœ í‘œì‹œ -->
    <div id="connectionStatus" class="connection-status connected">ğŸŸ¢ Firebase ì—°ê²°ë¨</div>

    <!-- ë©”ì¸ ì‹œìŠ¤í…œ (ëŒ€ì‹œë³´ë“œ) -->
    <div id="mainSystem">
        <!-- í—¤ë” -->
<!-- Header -->
<div class="header">
    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
</div>
        <main class="container">
            <!-- ëŒ€ì‹œë³´ë“œ (ë©”ì¸ í˜ì´ì§€) -->
            <div id="dashboardPage">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-4">ğŸ  ëŒ€ì‹œë³´ë“œ</h2>
                    
                    <!-- ê¸°ê°„ í•„í„° ì¶”ê°€ -->
                    <div class="filter-controls">
                        <div class="grid grid-cols-4 gap-4">
                            <div>
                                <label class="font-medium">ğŸ“… ê¸°ê°„ ì„ íƒ</label>
                                <select id="dashboardPeriod" onchange="loadDashboard()">
                                    <option value="today">ì˜¤ëŠ˜</option>
                                    <option value="week">ì´ë²ˆ ì£¼</option>
                                    <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                                    <option value="all">ì „ì²´</option>
                                    <option value="custom">ì‚¬ìš©ì ì •ì˜</option>
                                </select>
                            </div>
                            <div id="dashboardCustomRange" class="hidden grid grid-cols-2 gap-4" style="grid-column: span 2;">
                                <div>
                                    <label class="font-medium">ì‹œì‘ì¼</label>
                                    <input type="date" id="dashboardStartDate" onchange="loadDashboard()">
                                </div>
                                <div>
                                    <label class="font-medium">ì¢…ë£Œì¼</label>
                                    <input type="date" id="dashboardEndDate" onchange="loadDashboard()">
                                </div>
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button onclick="loadDashboard()" class="btn" style="height: fit-content;">
                                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalReviews">0</div>
                        <div class="stat-label">â­ ë„¤ì´ë²„ ë¦¬ë·°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPosts">0</div>
                        <div class="stat-label">ğŸ“ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalExperience">0</div>
                        <div class="stat-label">ğŸ¯ ì²´í—˜ë‹¨ ìš´ì˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalReels">0</div>
                        <div class="stat-label">ğŸ¬ ì¸ìŠ¤íƒ€ ë¦´ìŠ¤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPhotos">0</div>
                        <div class="stat-label">ğŸ“· ì¸ìŠ¤íƒ€ ì‚¬ì§„</div>
                    </div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 class="text-xl font-bold">ì§€ì ë³„ ì„±ê³¼ ìˆœìœ„</h3>
                        <button onclick="exportRankings()" class="btn btn-green">ğŸ“¥ ìˆœìœ„ ë‚´ë³´ë‚´ê¸°</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ìˆœìœ„</th>
                                    <th>ì§€ì </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('reviews')">
                                        â­ ë¦¬ë·° ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('posts')">
                                        ğŸ“ í¬ìŠ¤íŒ… ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('experience')">
                                        ğŸ¯ ì²´í—˜ë‹¨ ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('reels')">
                                        ğŸ¬ ë¦´ìŠ¤ ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('photos')">
                                        ğŸ“· ì‚¬ì§„ ğŸ”€
                                    </th>
                                    <th style="cursor: pointer;" onclick="sortRankings('total')">
                                        ì´í•© ğŸ”€
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="branchRankings">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <!-- JavaScript Files (ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ) -->
    <script src="js/config/firebase.js"></script>
    <script src="js/utils/data-manager.js"></script>
    <script src="js/utils/auth.js"></script>
    <script src="js/utils/ui-utils.js"></script>
    <script src="js/utils/navigation.js"></script>
    <script src="js/main.js"></script>
    
    <!-- í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë° ì´ˆê¸°í™” -->
    <script>
        // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
        function goToPage(pageId) {
            console.log('í˜ì´ì§€ ì´ë™ ì‹œë„:', pageId);
            
            const pages = {
                'designers': 'pages/designers.html',
                'branches': 'pages/branches.html', 
                'users': 'pages/users.html',
                'history': 'pages/history.html',
                'checklist': 'pages/checklist.html', 
                'statistics': 'pages/statistics.html',
                'comparison': 'pages/comparison.html'
            };
            
            if (pages[pageId]) {
                console.log('ì´ë™í•  ê²½ë¡œ:', pages[pageId]);
                window.location.href = pages[pageId];
            } else {
                console.error('ì•Œ ìˆ˜ ì—†ëŠ” í˜ì´ì§€:', pageId);
            }
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        function logout() {
            if (confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                sessionStorage.removeItem('currentUser');
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸ ë° ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ  ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            const userData = sessionStorage.getItem('currentUser') || localStorage.getItem('currentUser');
            if (!userData) {
                console.log('âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                window.location.href = 'login.html';
                return;
            }

            try {
                const currentUser = JSON.parse(userData);
                console.log('âœ… ë¡œê·¸ì¸ í™•ì¸:', currentUser);

                // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                const userElement = document.getElementById('currentUser');
                if (userElement) {
                    if (currentUser.role === 'ì§€ì ê´€ë¦¬ì') {
                        userElement.textContent = `${currentUser.name} (${currentUser.role} - ${currentUser.branch})`;
                        userElement.style.color = '#3b82f6';
                        
                        // ì§€ì ê´€ë¦¬ìëŠ” ì¼ë¶€ ë©”ë‰´ ìˆ¨ê¹€
                        document.querySelectorAll('.admin-only').forEach(btn => {
                            btn.style.display = 'none';
                        });
                    } else if (currentUser.role === 'ì „ì²´ê´€ë¦¬ì') {
                        userElement.textContent = `${currentUser.name} (${currentUser.role})`;
                        userElement.style.color = '#059669';
                    }
                }

                // ì•± ì´ˆê¸°í™” (main.jsì˜ initializeApp í˜¸ì¶œ)
                if (typeof initializeApp === 'function') {
                    initializeApp();
                } else {
                    console.warn('âš ï¸ initializeApp í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }

            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', error);
                window.location.href = 'login.html';
            }
        });

        console.log('ğŸ  ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
