<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì  ê´€ë¦¬ - GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../css/branches.css">
    
    <!-- ğŸ”¥ Firebase CDN ì¶”ê°€ -->
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore-compat.js"></script>

    <style>
        /* ê´€ë¦¬ì ê´€ë ¨ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .managers-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .manager-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        
        .manager-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .manager-name {
            font-weight: 600;
            color: #111827;
        }
        
        .manager-email {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .manager-phone, .manager-status {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .branch-managers-management {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .current-managers, .available-managers {
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background-color: #fafafa;
        }
        
        .current-managers h4, .available-managers h4 {
            margin: 0 0 1rem 0;
            color: #374151;
            font-weight: 600;
        }
        
        .badge-green {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .badge-red {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .btn-green {
            background-color: #10b981;
            color: white;
        }
        
        .btn-green:hover {
            background-color: #059669;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-top">
                <h1>GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <div class="header-actions">
                    <span id="currentUser"></span>
                    <button class="btn btn-green" onclick="exportBranches()">ğŸ“¥ ì§€ì  ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn" onclick="goToMainSystem()">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
                </div>
            </div>
            
            <nav class="nav">
                <button class="nav-btn" onclick="goToMainSystem()">ğŸ  ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="goToPage('designers')">ğŸ‘¥ ë””ìì´ë„ˆ ê´€ë¦¬</button>
                <button class="nav-btn active">ğŸ¢ ì§€ì  ê´€ë¦¬</button>
                <button class="nav-btn" onclick="goToPage('users')">ğŸ‘¤ ê³„ì • ê´€ë¦¬</button>
                <button class="nav-btn" onclick="goToPage('history')">ğŸ“ˆ ë””ìì´ë„ˆ íˆìŠ¤í† ë¦¬</button>
                <button class="nav-btn" onclick="goToPage('checklist')">ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì…ë ¥</button>
                <button class="nav-btn" onclick="goToPage('statistics')">ğŸ“Š í†µê³„ ë¶„ì„</button>
                <button class="nav-btn" onclick="goToPage('comparison')">âš–ï¸ ì§€ì  ë¹„êµ</button>
            </nav>
        </div>
    </div>

    <div class="container">
        <!-- ì§€ì  ê´€ë¦¬ í˜ì´ì§€ -->
        <div id="branchesPage">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-4">ğŸ¢ ì§€ì  ê´€ë¦¬</h2>
                
                <!-- ì§€ì  í†µê³„ ìš”ì•½ -->
                <div class="branch-stats-summary">
                    <div class="stats-item">
                        <div class="stats-icon">ğŸ¢</div>
                        <div class="stats-content">
                            <div class="stats-value" id="totalBranches">0</div>
                            <div class="stats-label">ì „ì²´ ì§€ì </div>
                        </div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-icon">ğŸ‘¥</div>
                        <div class="stats-content">
                            <div class="stats-value" id="totalDesigners">0</div>
                            <div class="stats-label">ì „ì²´ ë””ìì´ë„ˆ</div>
                        </div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-icon">ğŸ“Š</div>
                        <div class="stats-content">
                            <div class="stats-value" id="avgDesignersPerBranch">0</div>
                            <div class="stats-label">í‰ê·  ë””ìì´ë„ˆ/ì§€ì </div>
                        </div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-icon">ğŸ¯</div>
                        <div class="stats-content">
                            <div class="stats-value" id="topPerformingBranch">-</div>
                            <div class="stats-label">ìµœê³  ì„±ê³¼ ì§€ì </div>
                        </div>
                    </div>
                </div>

                <!-- í•„í„° ë° ê²€ìƒ‰ -->
                <div class="filter-controls">
                    <div class="search-filters">
                        <div class="search-group">
                            <label>ğŸ” ì§€ì  ê²€ìƒ‰</label>
                            <input type="text" id="branchSearch" class="search-input" 
                                   placeholder="ì§€ì ëª…, ì£¼ì†Œ, ì§€ì ì½”ë“œë¡œ ê²€ìƒ‰..." 
                                   onchange="loadBranches()">
                        </div>
                        <div class="filter-group">
                            <label>ğŸ“Š ì •ë ¬ ê¸°ì¤€</label>
                            <select id="branchSortBy" onchange="loadBranches()">
                                <option value="name">ì§€ì ëª…</option>
                                <option value="code">ì§€ì ì½”ë“œ</option>
                                <option value="designerCount">ë””ìì´ë„ˆ ìˆ˜</option>
                                <option value="managerCount">ê´€ë¦¬ì ìˆ˜</option>
                                <option value="performance">ì„±ê³¼</option>
                                <option value="createdAt">ë“±ë¡ì¼</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ğŸ”€ ì •ë ¬ ìˆœì„œ</label>
                            <select id="branchSortOrder" onchange="loadBranches()">
                                <option value="asc">ì˜¤ë¦„ì°¨ìˆœ</option>
                                <option value="desc">ë‚´ë¦¼ì°¨ìˆœ</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì§€ì  ëª©ë¡ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="text-xl font-bold">ë“±ë¡ëœ ì§€ì </h3>
                    <div class="header-actions">
                        <div class="view-toggle">
                            <button class="view-toggle-btn active" onclick="switchView('table')">
                                ğŸ“‹ í…Œì´ë¸”
                            </button>
                            <button class="view-toggle-btn" onclick="switchView('grid')">
                                ğŸ“± ì¹´ë“œ
                            </button>
                        </div>
                        <button onclick="showAddBranch()" class="btn">
                            â• ìƒˆ ì§€ì  ì¶”ê°€
                        </button>
                    </div>
                </div>
                
                <!-- í…Œì´ë¸” ë·° -->
                <div id="tableView" class="view-content">
                    <div class="overflow-x-auto">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ì§€ì ëª…</th>
                                    <th>ì§€ì ì½”ë“œ</th>
                                    <th>ì£¼ì†Œ</th>
                                    <th>ë””ìì´ë„ˆ ìˆ˜</th>
                                    <th>ì‹œìŠ¤í…œ ê´€ë¦¬ì</th>
                                    <th>ì›”ê°„ ì„±ê³¼</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="branchesList">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ê·¸ë¦¬ë“œ ë·° -->
                <div id="gridView" class="view-content hidden">
                    <div class="branches-grid" id="branchesGrid">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="pagination" id="branchesPagination">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ë“¤ -->
    <!-- ì§€ì  ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addBranchModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-bold">ğŸ¢ ìƒˆ ì§€ì  ì¶”ê°€</h3>
                <button onclick="hideAddBranch()" class="modal-close">âŒ</button>
            </div>
            <form id="addBranchForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸª ì§€ì ëª… <span class="required">*</span></label>
                        <input type="text" id="branchName" required placeholder="ì˜ˆ: ì†¡ë„ì„¼íŠ¸ëŸ´ì ">
                    </div>
                    <div class="form-group">
                        <label>ğŸ·ï¸ ì§€ì ì½”ë“œ <span class="required">*</span></label>
                        <input type="text" id="branchCode" required placeholder="ì˜ˆ: SD01" 
                               pattern="[A-Z]{2}[0-9]{2}" title="ëŒ€ë¬¸ì 2ì + ìˆ«ì 2ì (ì˜ˆ: SD01)">
                    </div>
                </div>
                <div class="form-group">
                    <label>ğŸ“ ì£¼ì†Œ <span class="required">*</span></label>
                    <input type="text" id="branchAddress" required placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“ ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="branchPhone" placeholder="032-123-4567">
                    </div>
                    <div class="form-group">
                        <label>ğŸƒâ€â™‚ï¸ ì ì¥ëª…</label>
                        <input type="text" id="branchManager" placeholder="ì ì¥ ì´ë¦„">
                    </div>
                </div>
                <div class="form-group">
                    <label>ğŸ• ìš´ì˜ì‹œê°„</label>
                    <input type="text" id="branchHours" placeholder="ì˜ˆ: 09:00 - 21:00">
                </div>
                <div class="form-group">
                    <label>ğŸ“ ë©”ëª¨</label>
                    <textarea id="branchNotes" rows="3" placeholder="ì§€ì  ê´€ë ¨ ë©”ëª¨ë‚˜ íŠ¹ì´ì‚¬í•­"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="hideAddBranch()" class="btn btn-secondary">âŒ ì·¨ì†Œ</button>
                    <button type="submit" class="btn">â• ì¶”ê°€</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì§€ì  í¸ì§‘ ëª¨ë‹¬ -->
    <div id="editBranchModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-bold">âœï¸ ì§€ì  ì •ë³´ ìˆ˜ì •</h3>
                <button onclick="hideEditBranch()" class="modal-close">âŒ</button>
            </div>
            <form id="editBranchForm">
                <input type="hidden" id="editBranchId">
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸª ì§€ì ëª… <span class="required">*</span></label>
                        <input type="text" id="editBranchName" required>
                    </div>
                    <div class="form-group">
                        <label>ğŸ·ï¸ ì§€ì ì½”ë“œ <span class="required">*</span></label>
                        <input type="text" id="editBranchCode" required pattern="[A-Z]{2}[0-9]{2}">
                    </div>
                </div>
                <div class="form-group">
                    <label>ğŸ“ ì£¼ì†Œ <span class="required">*</span></label>
                    <input type="text" id="editBranchAddress" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“ ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="editBranchPhone">
                    </div>
                    <div class="form-group">
                        <label>ğŸƒâ€â™‚ï¸ ì ì¥ëª…</label>
                        <input type="text" id="editBranchManager">
                    </div>
                </div>
                <div class="form-group">
                    <label>ğŸ• ìš´ì˜ì‹œê°„</label>
                    <input type="text" id="editBranchHours">
                </div>
                <div class="form-group">
                    <label>ğŸ“ ë©”ëª¨</label>
                    <textarea id="editBranchNotes" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="hideEditBranch()" class="btn btn-secondary">âŒ ì·¨ì†Œ</button>
                    <button type="submit" class="btn">ğŸ’¾ ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì§€ì  ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
    <div id="viewBranchModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="text-lg font-bold">ğŸ¢ ì§€ì  ìƒì„¸ ì •ë³´</h3>
                <button onclick="hideViewBranch()" class="modal-close">âŒ</button>
            </div>
            <div id="branchDetailContent">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="../js/config/firebase.js"></script>
    <script src="../js/utils/data-manager.js"></script>
    <script src="../js/utils/auth.js"></script>
    <script src="../js/utils/ui-utils.js"></script>
    <script src="../js/pages/branches.js"></script>

    <!-- í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ -->
    <script>
        function goToMainSystem() {
            window.location.href = '../index.html';  // ìƒìœ„ í´ë”ë¡œ ì´ë™
        }
        
        function goToPage(pageId) {
            const pages = {
                'designers': 'designers.html',
                'branches': 'branches.html',
                'users': 'users.html',          // ğŸ†• ì¶”ê°€!
                'history': 'history.html',
                'checklist': 'checklist.html', 
                'statistics': 'statistics.html',
                'comparison': 'comparison.html'
            };
            if (pages[pageId]) {
                window.location.href = pages[pageId];
            }
        }
    </script>

    <!-- ğŸ”¥ Firebase ì—°ê²° ìƒíƒœ í™•ì¸ ë° í‘œì‹œ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ  ë©”ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì‹œì‘');
            
            // ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¥¸ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ì œì–´
            function setupNavigationByRole() {
                try {
                    const userData = sessionStorage.getItem('currentUser');
                    const currentUser = userData ? JSON.parse(userData) : null;
                    
                    console.log('í˜„ì¬ ì‚¬ìš©ì:', currentUser);
                    
                    if (currentUser && currentUser.role === 'ì§€ì ê´€ë¦¬ì') {
                        // ì§€ì ê´€ë¦¬ìëŠ” ê³„ì • ê´€ë¦¬ ë©”ë‰´ ìˆ¨ê¹€
                        const userNavBtn = document.querySelector('.nav-btn[onclick*="users"]');
                        if (userNavBtn) {
                            userNavBtn.style.display = 'none';
                            console.log('ì§€ì ê´€ë¦¬ì - ê³„ì • ê´€ë¦¬ ë©”ë‰´ ìˆ¨ê¹€');
                        }
                        
                        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                        const userElement = document.getElementById('currentUser');
                        if (userElement) {
                            userElement.textContent = `${currentUser.name} (${currentUser.role} - ${currentUser.branch})`;
                            userElement.style.color = '#3b82f6';
                        }
                    } else if (currentUser && currentUser.role === 'ì „ì²´ê´€ë¦¬ì') {
                        // ì „ì²´ê´€ë¦¬ìëŠ” ëª¨ë“  ë©”ë‰´ í‘œì‹œ
                        const userElement = document.getElementById('currentUser');
                        if (userElement) {
                            userElement.textContent = `${currentUser.name} (${currentUser.role})`;
                            userElement.style.color = '#059669';
                        }
                    }
                } catch (error) {
                    console.error('ë„¤ë¹„ê²Œì´ì…˜ ê¶Œí•œ ì„¤ì • ì˜¤ë¥˜:', error);
                }
            }

            // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ì‹¤í–‰
            setupNavigationByRole();
            
            // Firebase ì—°ê²° ìƒíƒœ í™•ì¸
            if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                console.log('ğŸ”¥ íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²°ë¨');
            } else {
                console.log('âŒ íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨');
            }
            
            // 1ì´ˆ í›„ BranchesManager í™•ì¸
            setTimeout(() => {
                if (window.branchesManager) {
                    console.log('âœ… BranchesManager ì´ˆê¸°í™” ì™„ë£Œ');
                } else {
                    console.log('âš ï¸ BranchesManager ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...');
                }
            }, 1000);
        });

        // ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œê·¸
        window.addEventListener('error', function(e) {
            console.error('âŒ JavaScript ì—ëŸ¬:', e.message);
            console.error('ğŸ“ íŒŒì¼:', e.filename);
            console.error('ğŸ“ ë¼ì¸:', e.lineno);
        });
    </script>
</body>
</html>