<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì  ë¹„êµ - GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    
    <style>
        .date-picker-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .date-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-top: 0.5rem;
        }
        
        .date-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .calendar-toggle {
            padding: 0.5rem;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .calendar-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            padding: 1rem;
            margin-top: 0.25rem;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .calendar-nav {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            text-align: center;
        }
        
        .calendar-day {
            padding: 0.5rem;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }
        
        .calendar-day:hover {
            background: #f3f4f6;
        }
        
        .calendar-day.selected {
            background: #3b82f6;
            color: white;
        }
        
        .calendar-day.today {
            background: #fbbf24;
            color: white;
        }
        
        .calendar-day.other-month {
            color: #9ca3af;
        }
        
        .quick-select {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .quick-btn {
            padding: 0.25rem 0.75rem;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .quick-btn:hover {
            background: #e5e7eb;
        }
        
        .quick-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .custom-range {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 0.375rem;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
    
    <!-- Chart.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-top">
                <h1>GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <div class="header-actions">
                    <span id="currentUser"></span>
                    <button class="btn" onclick="goToMainSystem()">ğŸ  ë©”ì¸ìœ¼ë¡œ</button>
                </div>
            </div>
            
            <nav class="nav">
                <button class="nav-btn" onclick="goToMainSystem()">ğŸ  ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-btn" onclick="goToPage('designers')">ğŸ‘¥ ë””ìì´ë„ˆ ê´€ë¦¬</button>
                <button class="nav-btn" onclick="goToPage('branches')">ğŸ¢ ì§€ì  ê´€ë¦¬</button>
                <button class="nav-btn" onclick="goToPage('history')">ğŸ“ˆ ë””ìì´ë„ˆ íˆìŠ¤í† ë¦¬</button>
                <button class="nav-btn" onclick="goToPage('checklist')">ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì…ë ¥</button>
                <button class="nav-btn" onclick="goToPage('statistics')">ğŸ“Š í†µê³„ ë¶„ì„</button>
                <button class="nav-btn active">âš–ï¸ ì§€ì  ë¹„êµ</button>
            </nav>
        </div>
    </div>

    <div class="container">
        <div id="comparisonPage">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-4">âš–ï¸ ì§€ì  ë¹„êµ ë¶„ì„</h2>
                
                <div class="filter-controls">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-bold mb-4">ë¹„êµí•  ì§€ì  ì„ íƒ</h3>
                            <div class="mb-4">
                                <label style="display: flex; align-items: center; font-weight: 600; color: #6366f1;">
                                    <input type="checkbox" id="selectAllBranches" style="margin-right: 0.5rem;"> 
                                    âœ… ì „ì§€ì  ì„ íƒ
                                </label>
                            </div>
                            
                            <div id="branchCheckboxes" style="display: grid; gap: 0.5rem;">
                                <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                            </div>
                        </div>

                        <div>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <label class="font-medium">ğŸ“… ë¹„êµ ê¸°ê°„</label>
                                    <div class="date-picker-container">
                                        <select id="comparisonPeriod" onchange="handlePeriodChange()">
                                            <option value="today">ì˜¤ëŠ˜</option>
                                            <option value="week">ì´ë²ˆ ì£¼</option>
                                            <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                                            <option value="quarter">ì´ë²ˆ ë¶„ê¸°</option>
                                            <option value="all">ì „ì²´</option>
                                            <option value="custom">ì‚¬ìš©ì ì§€ì •</option>
                                        </select>
                                        
                                        <div class="date-input-group" id="dateInputGroup" style="display: none;">
                                            <input type="date" id="startDate" class="date-input" onchange="updateDateRange()">
                                            <span>~</span>
                                            <input type="date" id="endDate" class="date-input" onchange="updateDateRange()">
                                            <button class="calendar-toggle" onclick="toggleCalendar()">ğŸ“…</button>
                                        </div>
                                        
                                        <div class="calendar-container" id="calendarContainer">
                                            <div class="quick-select">
                                                <button class="quick-btn" onclick="selectQuickRange('today')">ì˜¤ëŠ˜</button>
                                                <button class="quick-btn" onclick="selectQuickRange('week')">ì´ë²ˆ ì£¼</button>
                                                <button class="quick-btn" onclick="selectQuickRange('month')">ì´ë²ˆ ë‹¬</button>
                                                <button class="quick-btn" onclick="selectQuickRange('quarter')">ì´ë²ˆ ë¶„ê¸°</button>
                                                <button class="quick-btn" onclick="selectQuickRange('all')">ì „ì²´</button>
                                            </div>
                                            
                                            <div class="calendar-header">
                                                <button class="calendar-nav" onclick="previousMonth()">â€¹</button>
                                                <span id="currentMonth"></span>
                                                <button class="calendar-nav" onclick="nextMonth()">â€º</button>
                                            </div>
                                            
                                            <div class="calendar-grid" id="calendarGrid">
                                                <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                                            </div>
                                            
                                            <div style="margin-top: 1rem; text-align: right;">
                                                <button class="btn" onclick="applyDateRange()" style="font-size: 0.875rem;">ì ìš©</button>
                                                <button class="btn" onclick="closeCalendar()" style="font-size: 0.875rem; margin-left: 0.5rem;">ë‹«ê¸°</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="font-medium">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</label>
                                    <select id="comparisonCategory">
                                        <option value="all">ì „ì²´</option>
                                        <option value="reviews">ë„¤ì´ë²„ ë¦¬ë·°</option>
                                        <option value="posts">ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…</option>
                                        <option value="experience">ì²´í—˜ë‹¨</option>
                                        <option value="reels">ì¸ìŠ¤íƒ€ ë¦´ìŠ¤</option>
                                        <option value="photos">ì¸ìŠ¤íƒ€ ì‚¬ì§„</option>
                                    </select>
                                </div>
                                
                                <button id="updateBtn" onclick="updateComparison()" class="btn" style="width: 100%;">
                                    ğŸ”„ ë¹„êµ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë¹„êµ ê²°ê³¼ -->
            <div id="comparisonResult" class="card">
                <div class="text-center" style="padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">âš–ï¸</div>
                    <p style="color: #6b7280;">ì§€ì ì„ ì„ íƒí•˜ê³  "ë¹„êµ ì°¨íŠ¸ ì—…ë°ì´íŠ¸" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="../js/config/firebase.js"></script>
    <script src="../js/config/data-manager.js"></script>
    <script src="../js/config/auth.js"></script>
    <script src="../js/config/ui-utils.js"></script>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        let currentCalendarDate = new Date();
        let selectedStartDate = null;
        let selectedEndDate = null;
        let isSelectingRange = false;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âš–ï¸ ì§€ì  ë¹„êµ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì„¤ì •
            setupCheckboxEvents();
            
            // ë‚ ì§œ ì´ˆê¸°í™”
            initializeDates();
            
            // Firebase ì—°ê²° í™•ì¸
            checkFirebaseConnection();
            
            // ì§€ì  ë°ì´í„° ë¡œë“œ
            loadBranchData();
        });
        
        // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì„¤ì •
        function setupCheckboxEvents() {
            const selectAllCheckbox = document.getElementById('selectAllBranches');
            
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    const branchCheckboxes = document.querySelectorAll('#branchCheckboxes input[type="checkbox"]');
                    branchCheckboxes.forEach(checkbox => {
                        checkbox.checked = this.checked;
                    });
                });
            }
        }
        
        // ì§€ì  ë°ì´í„° ë¡œë“œ
        function loadBranchData() {
            // ì„ì‹œ ì§€ì  ë°ì´í„° (ì‹¤ì œë¡œëŠ” Firebaseì—ì„œ ë¡œë“œ)
            const branches = ['ì†¡ë„1ì§€ì ', 'ê²€ë‹¨í…Œë¼ìŠ¤ì ', 'ë¶€í‰ì ', 'ì¸ì²œì ', 'ê°•ë‚¨ì '];
            
            const container = document.getElementById('branchCheckboxes');
            container.innerHTML = branches.map(branch => `
                <label style="display: flex; align-items: center;">
                    <input type="checkbox" value="${branch}" style="margin-right: 0.5rem;" onchange="updateSelectAll()">
                    ${branch}
                </label>
            `).join('');
        }
        
        // ì „ì²´ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllBranches');
            const branchCheckboxes = document.querySelectorAll('#branchCheckboxes input[type="checkbox"]');
            const checkedCount = document.querySelectorAll('#branchCheckboxes input[type="checkbox"]:checked').length;
            
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = checkedCount === branchCheckboxes.length;
            }
        }
        
        // Firebase ì—°ê²° í™•ì¸
        function checkFirebaseConnection() {
            const currentUser = document.getElementById('currentUser');
            
            if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                console.log('ğŸ”¥ íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²°ë¨');
                if (currentUser && !currentUser.textContent.trim()) {
                    currentUser.textContent = 'íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²°ë¨';
                    currentUser.style.color = '#10b981';
                }
            } else {
                console.log('âŒ íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨');
                if (currentUser && !currentUser.textContent.trim()) {
                    currentUser.textContent = 'íŒŒì´ì–´ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨';
                    currentUser.style.color = '#ef4444';
                }
            }
        }
        
        // ë‚ ì§œ ì´ˆê¸°í™”
        function initializeDates() {
            const today = new Date();
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            if (startDate && endDate) {
                startDate.value = today.toISOString().split('T')[0];
                endDate.value = today.toISOString().split('T')[0];
            }
        }
        
        // ê¸°ê°„ ë³€ê²½ ì²˜ë¦¬
        function handlePeriodChange() {
            const period = document.getElementById('comparisonPeriod').value;
            const dateInputGroup = document.getElementById('dateInputGroup');
            
            if (period === 'custom') {
                dateInputGroup.style.display = 'flex';
                updateDateRangeByPeriod('month'); // ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ë²ˆ ë‹¬ ì„¤ì •
            } else {
                dateInputGroup.style.display = 'none';
                updateDateRangeByPeriod(period);
            }
        }
        
        // ê¸°ê°„ë³„ ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸
        function updateDateRangeByPeriod(period) {
            const today = new Date();
            let startDate, endDate;
            
            switch(period) {
                case 'today':
                    startDate = endDate = new Date(today);
                    break;
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - today.getDay()); // ì´ë²ˆ ì£¼ ì¼ìš”ì¼
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6); // ì´ë²ˆ ì£¼ í† ìš”ì¼
                    break;
                case 'month':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    break;
                case 'quarter':
                    const quarter = Math.floor(today.getMonth() / 3);
                    startDate = new Date(today.getFullYear(), quarter * 3, 1);
                    endDate = new Date(today.getFullYear(), quarter * 3 + 3, 0);
                    break;
                case 'all':
                    startDate = new Date(2024, 0, 1); // 2024ë…„ 1ì›” 1ì¼
                    endDate = new Date(today);
                    break;
                default:
                    startDate = endDate = new Date(today);
            }
            
            selectedStartDate = startDate;
            selectedEndDate = endDate;
            
            // ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
            const startInput = document.getElementById('startDate');
            const endInput = document.getElementById('endDate');
            
            if (startInput && endInput) {
                startInput.value = startDate.toISOString().split('T')[0];
                endInput.value = endDate.toISOString().split('T')[0];
            }
        }
        
        // ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸
        function updateDateRange() {
            const startInput = document.getElementById('startDate');
            const endInput = document.getElementById('endDate');
            
            if (startInput.value) {
                selectedStartDate = new Date(startInput.value);
            }
            if (endInput.value) {
                selectedEndDate = new Date(endInput.value);
            }
        }
        
        // ìº˜ë¦°ë” í† ê¸€
        function toggleCalendar() {
            const calendar = document.getElementById('calendarContainer');
            const isVisible = calendar.style.display === 'block';
            
            if (isVisible) {
                closeCalendar();
            } else {
                calendar.style.display = 'block';
                generateCalendar();
            }
        }
        
        // ìº˜ë¦°ë” ë‹«ê¸°
        function closeCalendar() {
            document.getElementById('calendarContainer').style.display = 'none';
        }
        
        // ë¹ ë¥¸ ì„ íƒ
        function selectQuickRange(period) {
            // í™œì„± ë²„íŠ¼ í‘œì‹œ
            document.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateDateRangeByPeriod(period);
            generateCalendar();
        }
        
        // ìº˜ë¦°ë” ìƒì„±
        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthSpan = document.getElementById('currentMonth');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            monthSpan.textContent = `${year}ë…„ ${month + 1}ì›”`;
            
            // ìš”ì¼ í—¤ë”
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            let html = weekdays.map(day => `<div style="font-weight: bold; padding: 0.5rem;">${day}</div>`).join('');
            
            // ì²« ë²ˆì§¸ ë‚ ì˜ ìš”ì¼
            const firstDay = new Date(year, month, 1).getDay();
            
            // ì´ì „ ë‹¬ ë§ˆì§€ë§‰ ë‚ ë“¤
            const prevMonth = new Date(year, month, 0);
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = prevMonth.getDate() - i;
                html += `<button class="calendar-day other-month" onclick="selectDate(${year}, ${month - 1}, ${day})">${day}</button>`;
            }
            
            // í˜„ì¬ ë‹¬
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === today.toDateString();
                const isSelected = (selectedStartDate && date.toDateString() === selectedStartDate.toDateString()) ||
                                 (selectedEndDate && date.toDateString() === selectedEndDate.toDateString());
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (isSelected) classes += ' selected';
                
                html += `<button class="${classes}" onclick="selectDate(${year}, ${month}, ${day})">${day}</button>`;
            }
            
            // ë‹¤ìŒ ë‹¬ ì²« ë‚ ë“¤
            const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
            const remainingCells = totalCells - (firstDay + daysInMonth);
            
            for (let day = 1; day <= remainingCells; day++) {
                html += `<button class="calendar-day other-month" onclick="selectDate(${year}, ${month + 1}, ${day})">${day}</button>`;
            }
            
            grid.innerHTML = html;
        }
        
        // ë‚ ì§œ ì„ íƒ
        function selectDate(year, month, day) {
            const date = new Date(year, month, day);
            
            if (!isSelectingRange) {
                selectedStartDate = date;
                selectedEndDate = null;
                isSelectingRange = true;
            } else {
                if (date < selectedStartDate) {
                    selectedEndDate = selectedStartDate;
                    selectedStartDate = date;
                } else {
                    selectedEndDate = date;
                }
                isSelectingRange = false;
            }
            
            generateCalendar();
        }
        
        // ì´ì „ ë‹¬
        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            generateCalendar();
        }
        
        // ë‹¤ìŒ ë‹¬
        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            generateCalendar();
        }
        
        // ë‚ ì§œ ë²”ìœ„ ì ìš©
        function applyDateRange() {
            if (selectedStartDate && selectedEndDate) {
                document.getElementById('startDate').value = selectedStartDate.toISOString().split('T')[0];
                document.getElementById('endDate').value = selectedEndDate.toISOString().split('T')[0];
                document.getElementById('comparisonPeriod').value = 'custom';
                
                // ì‚¬ìš©ì ì§€ì • ì…ë ¥ í‘œì‹œ
                document.getElementById('dateInputGroup').style.display = 'flex';
            }
            closeCalendar();
        }
        
        // ë¹„êµ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê°œì„ ë¨)
        function updateComparison() {
            console.log('ğŸ”„ ë¹„êµ ì—…ë°ì´íŠ¸ ì‹œì‘');
            
            const selectedBranches = Array.from(document.querySelectorAll('#branchCheckboxes input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            
            if (selectedBranches.length === 0) {
                alert('ë¹„êµí•  ì§€ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const period = document.getElementById('comparisonPeriod').value;
            const category = document.getElementById('comparisonCategory').value;
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            const updateBtn = document.getElementById('updateBtn');
            updateBtn.disabled = true;
            updateBtn.innerHTML = '<span class="loading">â³</span> ë¶„ì„ ì¤‘...';
            
            // ë¡œë”© í‘œì‹œ
            document.getElementById('comparisonResult').innerHTML = `
                <div class="text-center" style="padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;" class="loading">â³</div>
                    <p style="color: #6b7280;">ë¹„êµ ë¶„ì„ ì¤‘...</p>
                </div>
            `;
            
            // ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” Firebase ë°ì´í„° ì²˜ë¦¬)
            setTimeout(() => {
                displayComparisonResult(selectedBranches, period, category);
                
                // ë²„íŠ¼ ë³µêµ¬
                updateBtn.disabled = false;
                updateBtn.innerHTML = 'ğŸ”„ ë¹„êµ ì°¨íŠ¸ ì—…ë°ì´íŠ¸';
            }, 1500);
        }
        
        // ë¹„êµ ê²°ê³¼ í‘œì‹œ
        function displayComparisonResult(branches, period, category) {
            // ì„ì‹œ ë°ì´í„° ìƒì„± (ì‹¤ì œë¡œëŠ” Firebaseì—ì„œ ê°€ì ¸ì˜´)
            const mockData = generateMockData(branches);
            
            const periodLabel = getPeriodLabel(period);
            const categoryLabel = getCategoryLabel(category);
            
            document.getElementById('comparisonResult').innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">ğŸ“Š ì§€ì  ë¹„êµ ê²°ê³¼</h3>
                    <div style="display: flex; gap: 2rem; margin-bottom: 1rem;">
                        <p><strong>ğŸ“ ì„ íƒ ì§€ì :</strong> ${branches.join(', ')}</p>
                        <p><strong>ğŸ“… ë¶„ì„ ê¸°ê°„:</strong> ${periodLabel}</p>
                        <p><strong>ğŸ·ï¸ ì¹´í…Œê³ ë¦¬:</strong> ${categoryLabel}</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    ${mockData.map((branch, index) => `
                        <div style="padding: 1.5rem; border-radius: 0.5rem; ${index === 0 ? 
                            'background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white;' : 
                            'background: white; border: 1px solid #e5e7eb;'}">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4 style="font-weight: bold;">${branch.name}</h4>
                                ${index === 0 ? '<span style="font-size: 1.5rem;">ğŸ†</span>' : ''}
                            </div>
                            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 1rem;">${branch.total}</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">
                                â­ ë¦¬ë·°: ${branch.reviews} | ğŸ“ í¬ìŠ¤íŒ…: ${branch.posts}<br>
                                ğŸ¯ ì²´í—˜ë‹¨: ${branch.experience} | ğŸ¬ ë¦´ìŠ¤: ${branch.reels} | ğŸ“· ì‚¬ì§„: ${branch.photos}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
                    <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
                        <h4 style="font-weight: bold; margin-bottom: 1rem;">ğŸ“ˆ ì§€ì ë³„ ìƒì„¸ ë¹„êµ</h4>
                        <canvas id="comparisonChart" height="300"></canvas>
                    </div>
                    
                    <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
                        <h4 style="font-weight: bold; margin-bottom: 1rem;">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ë¶„í¬</h4>
                        <canvas id="categoryChart" height="300"></canvas>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
                    <h4 style="font-weight: bold; margin-bottom: 1rem;">ğŸ’¡ ë¶„ì„ ì¸ì‚¬ì´íŠ¸</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 0.5rem;">â€¢ ${mockData[0].name}ì´ ì´ ${mockData[0].total}ê±´ìœ¼ë¡œ 1ìœ„ë¥¼ ì°¨ì§€í–ˆìŠµë‹ˆë‹¤.</li>
                        <li style="margin-bottom: 0.5rem;">â€¢ ì „ì²´ í‰ê·  ëŒ€ë¹„ ${Math.round((mockData[0].total / (mockData.reduce((sum, b) => sum + b.total, 0) / mockData.length) - 1) * 100)}% ë†’ì€ ì„±ê³¼ë¥¼ ë³´ì…ë‹ˆë‹¤.</li>
                        <li style="margin-bottom: 0.5rem;">â€¢ ${category === 'all' ? 'ë„¤ì´ë²„ ë¦¬ë·°' : categoryLabel} í™œë™ì´ ê°€ì¥ í™œë°œí•©ë‹ˆë‹¤.</li>
                    </ul>
                </div>
            `;
            
            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            setTimeout(() => {
                drawCharts(mockData);
            }, 100);
        }
        
        // ì„ì‹œ ë°ì´í„° ìƒì„±
        function generateMockData(branches) {
            return branches.map(branch => {
                const reviews = Math.floor(Math.random() * 50) + 10;
                const posts = Math.floor(Math.random() * 30) + 5;
                const experience = Math.floor(Math.random() * 20) + 3;
                const reels = Math.floor(Math.random() * 40) + 8;
                const photos = Math.floor(Math.random() * 60) + 15;
                
                return {
                    name: branch,
                    reviews,
                    posts,
                    experience,
                    reels,
                    photos,
                    total: reviews + posts + experience + reels + photos
                };
            }).sort((a, b) => b.total - a.total);
        }
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawCharts(data) {
            // ë¹„êµ ì°¨íŠ¸
            const comparisonCtx = document.getElementById('comparisonChart');
            if (comparisonCtx) {
                new Chart(comparisonCtx, {
                    type: 'bar',
                    data: {
                        labels: data.map(d => d.name),
                        datasets: [
                            {
                                label: 'â­ ë„¤ì´ë²„ ë¦¬ë·°',
                                data: data.map(d => d.reviews),
                                backgroundColor: 'rgba(59, 130, 246, 0.8)'
                            },
                            {
                                label: 'ğŸ“ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…',
                                data: data.map(d => d.posts),
                                backgroundColor: 'rgba(16, 185, 129, 0.8)'
                            },
                            {
                                label: 'ğŸ¯ ì²´í—˜ë‹¨',
                                data: data.map(d => d.experience),
                                backgroundColor: 'rgba(245, 158, 11, 0.8)'
                            },
                            {
                                label: 'ğŸ¬ ì¸ìŠ¤íƒ€ ë¦´ìŠ¤',
                                data: data.map(d => d.reels),
                                backgroundColor: 'rgba(239, 68, 68, 0.8)'
                            },
                            {
                                label: 'ğŸ“· ì¸ìŠ¤íƒ€ ì‚¬ì§„',
                                data: data.map(d => d.photos),
                                backgroundColor: 'rgba(139, 92, 246, 0.8)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { stacked: true },
                            y: { stacked: true, beginAtZero: true }
                        }
                    }
                });
            }
            
            // ì¹´í…Œê³ ë¦¬ ì°¨íŠ¸
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                const totalStats = data.reduce((acc, d) => {
                    acc.reviews += d.reviews;
                    acc.posts += d.posts;
                    acc.experience += d.experience;
                    acc.reels += d.reels;
                    acc.photos += d.photos;
                    return acc;
                }, { reviews: 0, posts: 0, experience: 0, reels: 0, photos: 0 });
                
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['â­ ë„¤ì´ë²„ ë¦¬ë·°', 'ğŸ“ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…', 'ğŸ¯ ì²´í—˜ë‹¨', 'ğŸ¬ ì¸ìŠ¤íƒ€ ë¦´ìŠ¤', 'ğŸ“· ì¸ìŠ¤íƒ€ ì‚¬ì§„'],
                        datasets: [{
                            data: [totalStats.reviews, totalStats.posts, totalStats.experience, totalStats.reels, totalStats.photos],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(139, 92, 246, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getPeriodLabel(period) {
            const labels = {
                today: 'ì˜¤ëŠ˜',
                week: 'ì´ë²ˆ ì£¼',
                month: 'ì´ë²ˆ ë‹¬',
                quarter: 'ì´ë²ˆ ë¶„ê¸°',
                all: 'ì „ì²´',
                custom: 'ì‚¬ìš©ì ì§€ì •'
            };
            return labels[period] || 'ì´ë²ˆ ë‹¬';
        }
        
        function getCategoryLabel(category) {
            const labels = {
                all: 'ì „ì²´',
                reviews: 'ë„¤ì´ë²„ ë¦¬ë·°',
                posts: 'ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…',
                experience: 'ì²´í—˜ë‹¨',
                reels: 'ì¸ìŠ¤íƒ€ ë¦´ìŠ¤',
                photos: 'ì¸ìŠ¤íƒ€ ì‚¬ì§„'
            };
            return labels[category] || 'ì „ì²´';
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
        function goToMainSystem() {
            window.location.href = '../index.html';
        }
        
        function goToPage(pageId) {
            const pages = {
                'designers': 'designers.html',
                'branches': 'branches.html',
                'history': 'history.html',
                'checklist': 'checklist.html',
                'statistics': 'statistics.html',
                'comparison': 'comparison.html'
            };
            
            if (pages[pageId]) {
                window.location.href = pages[pageId];
            }
        }
        
        // ì™¸ë¶€ í´ë¦­ ì‹œ ìº˜ë¦°ë” ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const calendar = document.getElementById('calendarContainer');
            const dateContainer = document.querySelector('.date-picker-container');
            
            if (calendar && calendar.style.display === 'block' && 
                !dateContainer.contains(event.target)) {
                closeCalendar();
            }
        });
    </script>
</body>
</html>
