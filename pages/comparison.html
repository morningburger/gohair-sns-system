<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì  ë¹„êµ - GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    
    <style>
        .date-picker-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .date-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-top: 0.5rem;
        }
        
        .date-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .calendar-toggle {
            padding: 0.5rem;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .calendar-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            padding: 1rem;
            margin-top: 0.25rem;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .calendar-nav {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            text-align: center;
        }
        
        .calendar-day {
            padding: 0.5rem;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }
        
        .calendar-day:hover {
            background: #f3f4f6;
        }
        
        .calendar-day.selected {
            background: #3b82f6;
            color: white;
        }
        
        .calendar-day.today {
            background: #fbbf24;
            color: white;
        }
        
        .calendar-day.other-month {
            color: #9ca3af;
        }
        
        .quick-select {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .quick-btn {
            padding: 0.25rem 0.75rem;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .quick-btn:hover {
            background: #e5e7eb;
        }
        
        .quick-btn.active {
            background: #3b82f6;
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes slide {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .firebase-status {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .firebase-connected {
            background: #dcfce7;
            color: #166534;
        }
        
        .firebase-disconnected {
            background: #fecaca;
            color: #dc2626;
        }
    </style>
    
    <!-- Chart.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Header -->
  <div class="header">
    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
</div>

    <div class="container">
        <div id="comparisonPage">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-4">âš–ï¸ ì§€ì  ë¹„êµ ë¶„ì„</h2>
                <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">
                    <p style="color: #92400e; font-size: 0.875rem;">
                        <strong>ğŸ“Š ì‹¤ì œ Firebase ë°ì´í„° ë¶„ì„:</strong> ì´ í˜ì´ì§€ëŠ” Firebaseì—ì„œ ì‹¤ì œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ë¶„ì„í•©ë‹ˆë‹¤. 
                        ì„ì˜ ê°’ì´ ì•„ë‹Œ ì‹¤ì œ ì…ë ¥ëœ ë°ì´í„°ë§Œì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    </p>
                </div>
                
                <div class="filter-controls">
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-bold mb-4">ë¹„êµí•  ì§€ì  ì„ íƒ</h3>
                            <div class="mb-4">
                                <label style="display: flex; align-items: center; font-weight: 600; color: #6366f1;">
                                    <input type="checkbox" id="selectAllBranches" style="margin-right: 0.5rem;"> 
                                    âœ… ì „ì§€ì  ì„ íƒ
                                </label>
                            </div>
                            
                            <div id="branchCheckboxes" style="display: grid; gap: 0.5rem;">
                                <div style="padding: 2rem; text-align: center; color: #6b7280;">
                                    <div style="font-size: 2rem; margin-bottom: 1rem;" class="loading">â³</div>
                                    <p>Firebaseì—ì„œ ì§€ì  ë°ì´í„°ë¥¼ ë¡œë”© ì¤‘...</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <label class="font-medium">ğŸ“… ë¹„êµ ê¸°ê°„</label>
                                    <div class="date-picker-container">
                                        <select id="comparisonPeriod" onchange="handlePeriodChange()">
                                            <option value="today">ì˜¤ëŠ˜</option>
                                            <option value="week">ì´ë²ˆ ì£¼</option>
                                            <option value="month" selected>ì´ë²ˆ ë‹¬</option>
                                            <option value="quarter">ì´ë²ˆ ë¶„ê¸°</option>
                                            <option value="all">ì „ì²´</option>
                                            <option value="custom">ì‚¬ìš©ì ì§€ì •</option>
                                        </select>
                                        
<div class="date-input-group" id="dateInputGroup" style="display: flex;">
    <input type="date" id="startDate" class="date-input" onchange="updateDateRange()">
    <span>~</span>
    <input type="date" id="endDate" class="date-input" onchange="updateDateRange()">
    <button class="calendar-toggle" onclick="toggleCalendar()">ğŸ“…</button>
</div>
                                        
                                        <div class="calendar-container" id="calendarContainer">
                                            <div class="quick-select">
                                                <button class="quick-btn" onclick="selectQuickRange('today')">ì˜¤ëŠ˜</button>
                                                <button class="quick-btn" onclick="selectQuickRange('week')">ì´ë²ˆ ì£¼</button>
                                                <button class="quick-btn" onclick="selectQuickRange('month')">ì´ë²ˆ ë‹¬</button>
                                                <button class="quick-btn" onclick="selectQuickRange('quarter')">ì´ë²ˆ ë¶„ê¸°</button>
                                                <button class="quick-btn" onclick="selectQuickRange('all')">ì „ì²´</button>
                                            </div>
                                            
                                            <div class="calendar-header">
                                                <button class="calendar-nav" onclick="previousMonth()">â€¹</button>
                                                <span id="currentMonth"></span>
                                                <button class="calendar-nav" onclick="nextMonth()">â€º</button>
                                            </div>
                                            
                                            <div class="calendar-grid" id="calendarGrid">
                                                <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                                            </div>
                                            
                                            <div style="margin-top: 1rem; text-align: right;">
                                                <button class="btn" onclick="applyDateRange()" style="font-size: 0.875rem;">ì ìš©</button>
                                                <button class="btn" onclick="closeCalendar()" style="font-size: 0.875rem; margin-left: 0.5rem;">ë‹«ê¸°</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="font-medium">ğŸ·ï¸ ì¹´í…Œê³ ë¦¬</label>
                                    <select id="comparisonCategory">
                                        <option value="all">ì „ì²´</option>
                                        <option value="reviews">ë„¤ì´ë²„ ë¦¬ë·°</option>
                                        <option value="posts">ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…</option>
                                        <option value="experience">ì²´í—˜ë‹¨</option>
                                        <option value="reels">ì¸ìŠ¤íƒ€ ë¦´ìŠ¤</option>
                                        <option value="photos">ì¸ìŠ¤íƒ€ ì‚¬ì§„</option>
                                    </select>
                                </div>
                                
                                <button id="updateBtn" onclick="updateComparison()" class="btn" style="width: 100%;">
                                    ğŸ”„ ë¹„êµ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë¹„êµ ê²°ê³¼ -->
            <div id="comparisonResult" class="card">
                <div class="text-center" style="padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">âš–ï¸</div>
                    <h3 style="margin-bottom: 1rem; color: #374151;">Firebase ë°ì´í„° ì—°ê²° ì¤‘...</h3>
                    <p style="color: #6b7280; margin-bottom: 1rem;">ì‹¤ì œ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    <div style="margin-top: 1rem;">
                        <div style="width: 200px; height: 4px; background: #e5e7eb; border-radius: 2px; margin: 0 auto; overflow: hidden;">
                            <div style="width: 100%; height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); animation: slide 2s ease-in-out infinite;"></div>
                        </div>
                    </div>
                    <p style="color: #6b7280; font-size: 0.875rem; margin-top: 1rem;">
                        ì§€ì ì„ ì„ íƒí•˜ê³  "ë¹„êµ ì°¨íŠ¸ ì—…ë°ì´íŠ¸" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files - ì˜¬ë°”ë¥¸ ê²½ë¡œë¡œ ìˆ˜ì • -->
    <script src="../js/config/firebase.js"></script>
    <script src="../js/utils/data-manager.js"></script>
    <script src="../js/utils/auth.js"></script>
    <script src="../js/utils/ui-utils.js"></script>
    <script src="../js/utils/navigation.js"></script>
    <!-- ë¹„êµ í˜ì´ì§€ ì „ìš© ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§ˆì§€ë§‰ì— ë¡œë“œ -->
    <script src="../js/pages/comparison.js"></script>

    <script>
        // ë””ë²„ê¹…ì„ ìœ„í•œ ì „ì—­ ë³€ìˆ˜
        window.debugMode = true;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ì—°ê²° ìƒíƒœ ì²´í¬
// í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ì—°ê²° ìƒíƒœ ì²´í¬
document.addEventListener('DOMContentLoaded', function() {
    console.log('âš–ï¸ ì§€ì  ë¹„êµ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
    
    // ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¥¸ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ì œì–´
    function setupNavigationByRole() {
        try {
            const userData = sessionStorage.getItem('currentUser');
            const currentUser = userData ? JSON.parse(userData) : null;
            
            console.log('í˜„ì¬ ì‚¬ìš©ì:', currentUser);
            
            if (currentUser && currentUser.role === 'ì§€ì ê´€ë¦¬ì') {
                // ì§€ì ê´€ë¦¬ìëŠ” ì§€ì  ê´€ë¦¬ ë©”ë‰´ ìˆ¨ê¹€
                const branchNavBtn = document.querySelector('.nav-btn[onclick*="branches"]');
                if (branchNavBtn) {
                    branchNavBtn.style.display = 'none';
                    console.log('ì§€ì ê´€ë¦¬ì - ì§€ì  ê´€ë¦¬ ë©”ë‰´ ìˆ¨ê¹€');
                }
                
                // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                const userElement = document.getElementById('currentUser');
                if (userElement) {
                    userElement.textContent = `${currentUser.name} (${currentUser.role} - ${currentUser.branch})`;
                    userElement.style.color = '#3b82f6';
                    userElement.className = 'firebase-status firebase-connected';
                }
            } else if (currentUser && currentUser.role === 'ì „ì²´ê´€ë¦¬ì') {
                // ì „ì²´ê´€ë¦¬ìëŠ” ëª¨ë“  ë©”ë‰´ í‘œì‹œ
                const userElement = document.getElementById('currentUser');
                if (userElement) {
                    userElement.textContent = `${currentUser.name} (${currentUser.role})`;
                    userElement.style.color = '#059669';
                    userElement.className = 'firebase-status firebase-connected';
                }
            }
        } catch (error) {
            console.error('ë„¤ë¹„ê²Œì´ì…˜ ê¶Œí•œ ì„¤ì • ì˜¤ë¥˜:', error);
        }
    }

    // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì • ì‹¤í–‰
    setupNavigationByRole();
    
    // Firebase ì—°ê²° ìƒíƒœ í‘œì‹œ
    updateFirebaseStatus();
    
    // ì™¸ë¶€ í´ë¦­ ì‹œ ìº˜ë¦°ë” ë‹«ê¸°
    setupGlobalEventListeners();
    
    // ComparisonManager ì´ˆê¸°í™” í™•ì¸
    checkComparisonManagerInit();
});
        
        // ComparisonManager ì´ˆê¸°í™” í™•ì¸
        function checkComparisonManagerInit() {
            let checkCount = 0;
            const maxChecks = 10;
            
            const checkInterval = setInterval(() => {
                checkCount++;
                
                if (window.comparisonManager && window.comparisonManager.isDataLoaded) {
                    console.log('âœ… ComparisonManager ì´ˆê¸°í™” ì™„ë£Œ í™•ì¸');
                    clearInterval(checkInterval);
                    return;
                }
                
                if (checkCount >= maxChecks) {
                    console.log('âš ï¸ ComparisonManager ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ');
                    clearInterval(checkInterval);
                    
                    // ìˆ˜ë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„
                    if (typeof ComparisonManager !== 'undefined') {
                        console.log('ğŸ”„ ComparisonManager ìˆ˜ë™ ì´ˆê¸°í™” ì‹œë„');
                        window.comparisonManager = new ComparisonManager();
                        window.comparisonManager.initialize();
                    } else {
                        console.log('âŒ ComparisonManager í´ë˜ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                        document.getElementById('comparisonResult').innerHTML = `
                            <div class="text-center" style="padding: 3rem;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">âŒ</div>
                                <h3 style="color: #dc2626; margin-bottom: 1rem;">ì´ˆê¸°í™” ì‹¤íŒ¨</h3>
                                <p style="color: #6b7280;">ComparisonManagerë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                                <button onclick="location.reload()" class="btn" style="margin-top: 1rem;">ğŸ”„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
                            </div>
                        `;
                    }
                }
                
                console.log(`â³ ComparisonManager ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘... (${checkCount}/${maxChecks})`);
            }, 1000);
        }
        
        // Firebase ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateFirebaseStatus() {
            const currentUser = document.getElementById('currentUser');
            
            // Firebase SDK ë¡œë“œ í™•ì¸
            if (typeof firebase === 'undefined') {
                console.log('âŒ Firebase SDK ë¡œë“œ ì‹¤íŒ¨');
                if (currentUser) {
                    currentUser.textContent = 'âŒ Firebase SDK ì—†ìŒ';
                    currentUser.className = 'firebase-status firebase-disconnected';
                }
                return;
            }
            
            // Firebase ì•± ì´ˆê¸°í™” í™•ì¸
            if (firebase.apps.length === 0) {
                console.log('âŒ Firebase ì•±ì´ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
                if (currentUser) {
                    currentUser.textContent = 'âŒ Firebase ì•± ë¯¸ì´ˆê¸°í™”';
                    currentUser.className = 'firebase-status firebase-disconnected';
                }
                return;
            }
            
            // Firestore ì—°ê²° í™•ì¸
            try {
                const db = firebase.firestore();
                if (db) {
                    console.log('âœ… Firebase ì™„ì „ ì—°ê²°ë¨');
                    if (currentUser) {
                        currentUser.textContent = 'ğŸ”¥ Firebase ì—°ê²°ë¨';
                        currentUser.className = 'firebase-status firebase-connected';
                    }
                    
                    // ê°„ë‹¨í•œ ì—°ê²° í…ŒìŠ¤íŠ¸
                    testFirebaseConnection(db);
                } else {
                    throw new Error('Firestore ì¸ìŠ¤í„´ìŠ¤ ì—†ìŒ');
                }
            } catch (error) {
                console.log('âŒ Firestore ì—°ê²° ì‹¤íŒ¨:', error);
                if (currentUser) {
                    currentUser.textContent = 'âŒ Firestore ì‹¤íŒ¨';
                    currentUser.className = 'firebase-status firebase-disconnected';
                }
            }
        }
        
        // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸
        function testFirebaseConnection(db) {
            console.log('ğŸ” Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            // branches ì»¬ë ‰ì…˜ í…ŒìŠ¤íŠ¸
            db.collection('branches').limit(1).get()
                .then((snapshot) => {
                    console.log('âœ… branches ì»¬ë ‰ì…˜ ì ‘ê·¼ ì„±ê³µ');
                    console.log('ğŸ“Š branches ë¬¸ì„œ ìˆ˜:', snapshot.size);
                    
                    if (snapshot.size > 0) {
                        const doc = snapshot.docs[0];
                        console.log('ğŸ“„ ì²« ë²ˆì§¸ ì§€ì  ë°ì´í„°:', doc.data());
                    }
                })
                .catch((error) => {
                    console.log('âŒ branches ì»¬ë ‰ì…˜ ì ‘ê·¼ ì‹¤íŒ¨:', error);
                });
            
            // checklists ì»¬ë ‰ì…˜ í…ŒìŠ¤íŠ¸
            db.collection('checklists').limit(1).get()
                .then((snapshot) => {
                    console.log('âœ… checklists ì»¬ë ‰ì…˜ ì ‘ê·¼ ì„±ê³µ');
                    console.log('ğŸ“Š checklists ë¬¸ì„œ ìˆ˜:', snapshot.size);
                    
                    if (snapshot.size > 0) {
                        const doc = snapshot.docs[0];
                        console.log('ğŸ“„ ì²« ë²ˆì§¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„°:', doc.data());
                    }
                })
                .catch((error) => {
                    console.log('âŒ checklists ì»¬ë ‰ì…˜ ì ‘ê·¼ ì‹¤íŒ¨:', error);
                });
        }
        
        // ì „ì—­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupGlobalEventListeners() {
            // ì™¸ë¶€ í´ë¦­ ì‹œ ìº˜ë¦°ë” ë‹«ê¸°
            document.addEventListener('click', function(event) {
                const calendar = document.getElementById('calendarContainer');
                const dateContainer = document.querySelector('.date-picker-container');
                
                if (calendar && calendar.style.display === 'block' && 
                    dateContainer && !dateContainer.contains(event.target)) {
                    closeCalendar();
                }
            });
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
        function goToMainSystem() {
            window.location.href = '../index.html';
        }
        
        function goToPage(pageId) {
            const pages = {
                'designers': 'designers.html',
                'branches': 'branches.html',
                'history': 'history.html',
                'checklist': 'checklist.html',
                'statistics': 'statistics.html',
                'comparison': 'comparison.html'
            };
            
            if (pages[pageId]) {
                window.location.href = pages[pageId];
            }
        }
        
        // ì „ì—­ í•¨ìˆ˜ë“¤ (comparison.jsì—ì„œ ì‚¬ìš©)
        function updateDateRange() {
            if (window.comparisonManager) {
                const startInput = document.getElementById('startDate');
                const endInput = document.getElementById('endDate');
                
                if (startInput.value) {
                    window.comparisonManager.customStartDate = new Date(startInput.value);
                }
                if (endInput.value) {
                    window.comparisonManager.customEndDate = new Date(endInput.value);
                }
            }
        }
        
        // ìº˜ë¦°ë” ê´€ë ¨ ì „ì—­ í•¨ìˆ˜ë“¤
        function toggleCalendar() {
            const calendar = document.getElementById('calendarContainer');
            const isVisible = calendar.style.display === 'block';
            
            if (isVisible) {
                closeCalendar();
            } else {
                calendar.style.display = 'block';
                generateCalendar();
            }
        }
        
        function closeCalendar() {
            document.getElementById('calendarContainer').style.display = 'none';
        }
        
        function generateCalendar() {
            // ê¸°ë³¸ ìº˜ë¦°ë” ìƒì„± ë¡œì§
            const grid = document.getElementById('calendarGrid');
            const monthSpan = document.getElementById('currentMonth');
            
            if (!grid || !monthSpan) return;
            
            const currentDate = window.currentCalendarDate || new Date();
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            monthSpan.textContent = `${year}ë…„ ${month + 1}ì›”`;
            
            // ê°„ë‹¨í•œ ìº˜ë¦°ë” ìƒì„±
            grid.innerHTML = '<div style="padding: 1rem; text-align: center;">ìº˜ë¦°ë” êµ¬í˜„ ì¤‘...</div>';
        }
        
        // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
        window.currentCalendarDate = new Date();
        window.selectedStartDate = null;
        window.selectedEndDate = null;
        window.isSelectingRange = false;
    </script>
</body>
</html>
