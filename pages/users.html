<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì • ê´€ë¦¬ - GOHAIR SNS ë§ˆì¼€íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../css/branches.css">
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore-compat.js"></script>
    
    <style>
        .user-status {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-active { background-color: #dcfce7; color: #166534; }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-suspended { background-color: #fee2e2; color: #991b1b; }
        
        .user-role {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .role-admin { background-color: #dbeafe; color: #1e40af; }
        .role-manager { background-color: #e0e7ff; color: #3730a3; }
        
        .pending-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .stats-pending {
            background-color: #fef3c7;
            border: 2px solid #f59e0b;
        }
        
        .user-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .detail-section {
            background-color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        
        .detail-section h4 {
            margin: 0 0 0.75rem 0;
            color: #374151;
            font-weight: 600;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 500;
            color: #6b7280;
        }
        
        .detail-value {
            color: #111827;
        }
    </style>
</head>
<body>
<!-- Header -->
<div class="header">
    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
</div>

    <div class="container">
        <!-- ê³„ì • ê´€ë¦¬ í˜ì´ì§€ -->
        <div id="usersPage">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-4">ğŸ‘¤ ê³„ì • ê´€ë¦¬</h2>
                
                <!-- ê³„ì • í†µê³„ ìš”ì•½ -->
                <div class="branch-stats-summary">
                    <div class="stats-item">
                        <div class="stats-icon">ğŸ‘¥</div>
                        <div class="stats-content">
                            <div class="stats-value" id="totalUsers">0</div>
                            <div class="stats-label">ì „ì²´ ê³„ì •</div>
                        </div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-icon">âœ…</div>
                        <div class="stats-content">
                            <div class="stats-value" id="activeUsers">0</div>
                            <div class="stats-label">í™œì„± ê³„ì •</div>
                        </div>
                    </div>
                    <div class="stats-item stats-pending">
                        <div class="stats-icon">â³</div>
                        <div class="stats-content">
                            <div class="stats-value" id="pendingUsers">0</div>
                            <div class="stats-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
                        </div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-icon">ğŸ¢</div>
                        <div class="stats-content">
                            <div class="stats-value" id="branchManagers">0</div>
                            <div class="stats-label">ì§€ì ê´€ë¦¬ì</div>
                        </div>
                    </div>
                </div>

                <!-- í•„í„° ë° ê²€ìƒ‰ -->
                <div class="filter-controls">
                    <div class="search-filters">
                        <div class="search-group">
                            <label>ğŸ” ê³„ì • ê²€ìƒ‰</label>
                            <input type="text" id="userSearch" class="search-input" 
                                   placeholder="ì´ë¦„, ì´ë©”ì¼, ì§€ì ëª…ìœ¼ë¡œ ê²€ìƒ‰...">
                        </div>
                        <div class="filter-group">
                            <label>ğŸ‘¤ ì—­í• </label>
                            <select id="roleFilter">
                                <option value="">ì „ì²´</option>
                                <option value="ì „ì²´ê´€ë¦¬ì">ì „ì²´ê´€ë¦¬ì</option>
                                <option value="ì§€ì ê´€ë¦¬ì">ì§€ì ê´€ë¦¬ì</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ğŸ“Š ìƒíƒœ</label>
                            <select id="statusFilter">
                                <option value="">ì „ì²´</option>
                                <option value="active">í™œì„±</option>
                                <option value="pending">ìŠ¹ì¸ ëŒ€ê¸°</option>
                                <option value="suspended">ì •ì§€</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ğŸ¢ ì§€ì </label>
                            <select id="branchFilter">
                                <option value="">ì „ì²´</option>
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³„ì • ëª©ë¡ -->
            <div class="card">
                <div class="card-header">
                    <h3 class="text-xl font-bold">ë“±ë¡ëœ ê³„ì •</h3>
                    <div class="header-actions">
                        <button onclick="showAddUser()" class="btn">
                            â• ìƒˆ ê³„ì • ì¶”ê°€
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="table">
<thead>
    <tr>
        <th>ì´ë¦„</th>
        <th>ì´ë©”ì¼</th>
        <th>ì—­í• </th>
        <th>ì§€ì </th>
        <th>ë¹„ë°€ë²ˆí˜¸</th>
        <th>ìƒíƒœ</th>
        <th>ê°€ì…ì¼</th>
        <th>ìµœê·¼ ë¡œê·¸ì¸</th>
        <th>ê´€ë¦¬</th>
    </tr>
</thead>
                        <tbody id="usersList">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </tbody>
                    </table>
                </div>

                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="pagination" id="usersPagination">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ë“¤ -->
    <!-- ê³„ì • ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addUserModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-bold">ğŸ‘¤ ìƒˆ ê³„ì • ì¶”ê°€</h3>
                <button onclick="hideAddUser()" class="modal-close">âŒ</button>
            </div>
            <form id="addUserForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ‘¤ ì´ë¦„ <span class="required">*</span></label>
                        <input type="text" id="userName" required placeholder="í™ê¸¸ë™">
                    </div>
                    <div class="form-group">
                        <label>ğŸ“§ ì´ë©”ì¼ <span class="required">*</span></label>
                        <input type="email" id="userEmail" required placeholder="user@example.com">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ‘‘ ì—­í•  <span class="required">*</span></label>
                        <select id="userRole" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì „ì²´ê´€ë¦¬ì">ì „ì²´ê´€ë¦¬ì</option>
                            <option value="ì§€ì ê´€ë¦¬ì">ì§€ì ê´€ë¦¬ì</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ğŸ“ ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="userPhone" placeholder="010-1234-5678">
                    </div>
                </div>
                <div class="form-group" id="branchSelectGroup" style="display: none;">
                    <label>ğŸ¢ ë‹´ë‹¹ ì§€ì  <span class="required">*</span></label>
                    <select id="userBranch">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ“ ë©”ëª¨</label>
                    <textarea id="userNotes" rows="3" placeholder="ê³„ì • ê´€ë ¨ ë©”ëª¨"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="hideAddUser()" class="btn btn-secondary">âŒ ì·¨ì†Œ</button>
                    <button type="submit" class="btn">â• ì¶”ê°€</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ê³„ì • ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
    <div id="viewUserModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="text-lg font-bold">ğŸ‘¤ ê³„ì • ìƒì„¸ ì •ë³´</h3>
                <button onclick="hideViewUser()" class="modal-close">âŒ</button>
            </div>
            <div id="userDetailContent">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>
    </div>

    <!-- ê³„ì • í¸ì§‘ ëª¨ë‹¬ -->
    <div id="editUserModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-bold">âœï¸ ê³„ì • ì •ë³´ ìˆ˜ì •</h3>
                <button onclick="hideEditUser()" class="modal-close">âŒ</button>
            </div>
        <form id="changePasswordForm">
            <input type="hidden" id="changePasswordUserId">
            <div class="form-group">
                <label>ğŸ‘¤ ì‚¬ìš©ì</label>
                <input type="text" id="changePasswordUserName" readonly style="background-color: #f9fafb;">
            </div>
            <div class="form-group">
                <label>ğŸ”’ ìƒˆ ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
                <input type="password" id="newPassword" required minlength="6">
            </div>
            <div class="form-group">
                <label>ğŸ”’ ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="required">*</span></label>
                <input type="password" id="newPasswordConfirm" required minlength="6">
                <div id="newPasswordMatchMessage" style="margin-top: 0.5rem; font-size: 0.875rem;"></div>
            </div>
            <div class="modal-actions">
                <button type="button" onclick="hideChangePassword()" class="btn btn-secondary">âŒ ì·¨ì†Œ</button>
                <button type="submit" class="btn">ğŸ”‘ ë³€ê²½</button>
            </div>
        </form>
    </div>
</div>
            
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ‘¤ ì´ë¦„ <span class="required">*</span></label>
                        <input type="text" id="editUserName" required>
                    </div>
                    <div class="form-group">
                        <label>ğŸ“§ ì´ë©”ì¼ <span class="required">*</span></label>
                        <input type="email" id="editUserEmail" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ‘‘ ì—­í•  <span class="required">*</span></label>
                        <select id="editUserRole" required>
                            <option value="ì „ì²´ê´€ë¦¬ì">ì „ì²´ê´€ë¦¬ì</option>
                            <option value="ì§€ì ê´€ë¦¬ì">ì§€ì ê´€ë¦¬ì</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ğŸ“ ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="editUserPhone">
                    </div>
                </div>
                <div class="form-group" id="editBranchSelectGroup">
                    <label>ğŸ¢ ë‹´ë‹¹ ì§€ì  <span class="required">*</span></label>
                    <select id="editUserBranch">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ“Š ìƒíƒœ <span class="required">*</span></label>
                    <select id="editUserStatus" required>
                        <option value="active">í™œì„±</option>
                        <option value="suspended">ì •ì§€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ“ ë©”ëª¨</label>
                    <textarea id="editUserNotes" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" onclick="hideEditUser()" class="btn btn-secondary">âŒ ì·¨ì†Œ</button>
                    <button type="submit" class="btn">ğŸ’¾ ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>
<!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ -->
<div id="changePasswordModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="text-lg font-bold">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
            <button onclick="hideChangePassword()" class="modal-close">âŒ</button>
        </div>
    <!-- JavaScript Files -->
<script src="../js/config/firebase.js"></script>
<script src="../js/utils/data-manager.js"></script>
<script src="../js/utils/auth.js"></script>
<script src="../js/utils/ui-utils.js"></script>
<script src="../js/utils/navigation.js"></script>
<script src="../js/pages/users.js"></script>    <script>
        // ì‚¬ìš©ì ê´€ë¦¬ í´ë˜ìŠ¤
        class UsersManager {
            constructor() {
                this.data = {
                    users: [],
                    branches: []
                };
                this.currentUser = null;
                this.pagination = {
                    currentPage: 1,
                    itemsPerPage: 10,
                    totalItems: 0,
                    totalPages: 0
                };
                this.filters = {
                    search: '',
                    role: '',
                    status: '',
                    branch: ''
                };
            }

 async initialize() {
    try {
        this.currentUser = this.getCurrentUser();
        
        if (!this.currentUser || this.currentUser.role !== 'ì „ì²´ê´€ë¦¬ì') {
            alert('ì´ í˜ì´ì§€ëŠ” ì „ì²´ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            window.location.href = '../index.html';
            return;
        }

        await this.loadAllData();
        this.setupEventListeners();
        this.loadUsers();
        
        console.log('ê³„ì • ê´€ë¦¬ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
    } catch (error) {
        console.error('ê³„ì • ê´€ë¦¬ í˜ì´ì§€ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
    }
}

            getCurrentUser() {
                try {
                    const userData = sessionStorage.getItem('currentUser');
                    return userData ? JSON.parse(userData) : null;
                } catch {
                    return null;
                }
            }


            async loadAllData() {
                try {
                    // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
                    this.data.users = await this.loadUsersFromFirebase();
                    
                    // ì§€ì  ë°ì´í„° ë¡œë“œ
                    this.data.branches = await this.loadBranchesFromFirebase();
                    
                    // ì§€ì  í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸
                    this.updateBranchFilterOptions();
                    
                    console.log('âœ… ëª¨ë“  ë°ì´í„° ë¡œë”© ì™„ë£Œ');
                    console.log(`- ì‚¬ìš©ì: ${this.data.users.length}ê°œ`);
                    console.log(`- ì§€ì : ${this.data.branches.length}ê°œ`);
                } catch (error) {
                    console.error('âŒ ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜:', error);
                    throw error;
                }
            }

            async loadUsersFromFirebase() {
                try {
                    if (typeof firebase === 'undefined' || firebase.apps.length === 0) {
                        return [];
                    }

                    const db = firebase.firestore();
                    const snapshot = await db.collection('users').get();
                    
                    const users = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
users.push({
    id: doc.id,
    docId: doc.id,
    name: data.name || '',
    email: data.email || '',
    role: data.role || '',
    branch: data.branch || '',
    branchCode: data.branchCode || '',
    phone: data.phone || '',
    password: data.password || '', // ë¹„ë°€ë²ˆí˜¸ ì¶”ê°€
    status: data.status || 'active',
    notes: data.notes || '',
    createdAt: data.createdAt || new Date().toISOString().split('T')[0],
    lastLogin: data.lastLogin || '',
    approvedBy: data.approvedBy || '',
    approvedAt: data.approvedAt || ''
});
                    });
                    
                    return users;
                } catch (error) {
                    console.error('âŒ ì‚¬ìš©ì ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                    return [];
                }
            }

            async loadBranchesFromFirebase() {
                try {
                    if (typeof firebase === 'undefined' || firebase.apps.length === 0) {
                        return [];
                    }

                    const db = firebase.firestore();
                    const snapshot = await db.collection('branches').get();
                    
                    const branches = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        branches.push({
                            id: doc.id,
                            name: data.name || '',
                            code: data.code || ''
                        });
                    });
                    
                    return branches;
                } catch (error) {
                    console.error('âŒ ì§€ì  ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                    return [];
                }
            }

            updateBranchFilterOptions() {
                const branchFilter = document.getElementById('branchFilter');
                const userBranch = document.getElementById('userBranch');
                const editUserBranch = document.getElementById('editUserBranch');
                
                const options = this.data.branches.map(branch => 
                    `<option value="${branch.name}">${branch.name} (${branch.code})</option>`
                ).join('');
                
                if (branchFilter) {
                    branchFilter.innerHTML = '<option value="">ì „ì²´</option>' + options;
                }
                
                if (userBranch) {
                    userBranch.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' + options;
                }
                
                if (editUserBranch) {
                    editUserBranch.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' + options;
                }
            }

            loadUsers() {
                let users = [...this.data.users];
                
                // ê²€ìƒ‰ í•„í„° ì ìš©
                if (this.filters.search) {
                    const searchTerm = this.filters.search.toLowerCase();
                    users = users.filter(user => 
                        user.name.toLowerCase().includes(searchTerm) ||
                        user.email.toLowerCase().includes(searchTerm) ||
                        (user.branch && user.branch.toLowerCase().includes(searchTerm))
                    );
                }

                // ì—­í•  í•„í„° ì ìš©
                if (this.filters.role) {
                    users = users.filter(user => user.role === this.filters.role);
                }

                // ìƒíƒœ í•„í„° ì ìš©
                if (this.filters.status) {
                    users = users.filter(user => user.status === this.filters.status);
                }

                // ì§€ì  í•„í„° ì ìš©
                if (this.filters.branch) {
                    users = users.filter(user => user.branch === this.filters.branch);
                }

                // ì •ë ¬ (ì´ë¦„ìˆœ)
                users.sort((a, b) => a.name.localeCompare(b.name));

                // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
                this.pagination.totalItems = users.length;
                this.pagination.totalPages = Math.ceil(users.length / this.pagination.itemsPerPage);
                
                const startIndex = (this.pagination.currentPage - 1) * this.pagination.itemsPerPage;
                const endIndex = startIndex + this.pagination.itemsPerPage;
                const paginatedUsers = users.slice(startIndex, endIndex);

                // í†µê³„ ì—…ë°ì´íŠ¸
                this.updateUserStats(this.data.users);

                // í…Œì´ë¸” ë Œë”ë§
                this.renderUsersTable(paginatedUsers);

                // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
                this.renderPagination();
            }

            updateUserStats(users) {
                const totalUsers = users.length;
                const activeUsers = users.filter(u => u.status === 'active').length;
                const pendingUsers = users.filter(u => u.status === 'pending').length;
                const branchManagers = users.filter(u => u.role === 'ì§€ì ê´€ë¦¬ì').length;

                document.getElementById('totalUsers').textContent = totalUsers;
                document.getElementById('activeUsers').textContent = activeUsers;
                document.getElementById('pendingUsers').textContent = pendingUsers;
                document.getElementById('branchManagers').textContent = branchManagers;
            }

            renderUsersTable(users) {
                const tbody = document.getElementById('usersList');
                if (!tbody) return;

                if (users.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" class="text-center py-8">
                                <div class="empty-state">
                                    <div class="empty-state-icon">ğŸ‘¤</div>
                                    <p>ë“±ë¡ëœ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

tbody.innerHTML = users.map(user => `
    <tr class="user-row" data-user-id="${user.id}">
        <td class="font-medium">${user.name}</td>
        <td>${user.email}</td>
        <td>
            <span class="user-role role-${user.role === 'ì „ì²´ê´€ë¦¬ì' ? 'admin' : 'manager'}">
                ${user.role}
            </span>
        </td>
        <td>${user.branch || '-'}</td>
        <td>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="font-family: monospace; background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.875rem;">
                    ${user.password || '***'}
                </span>
                <button onclick="changePassword('${user.docId}')" 
                        class="btn btn-sm" 
                        title="ë¹„ë°€ë²ˆí˜¸ ë³€ê²½" 
                        style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">
                    ğŸ”‘
                </button>
            </div>
        </td>
        <td>
            <span class="user-status status-${user.status}">
                ${this.getStatusLabel(user.status)}
            </span>
        </td>
        <td>${user.createdAt}</td>
        <td>${user.lastLogin || '-'}</td>
        <td>
            <div class="flex gap-1">
                ${user.status === 'pending' ? `
                    <div class="pending-actions">
                        <button onclick="approveUser('${user.docId}')" 
                                class="btn btn-green btn-sm" 
                                title="ìŠ¹ì¸">âœ…</button>
                        <button onclick="rejectUser('${user.docId}')" 
                                class="btn btn-red btn-sm" 
                                title="ê±°ë¶€">âŒ</button>
                    </div>
                ` : `
                    <button onclick="viewUser('${user.docId}')" 
                            class="btn btn-sm" title="ìƒì„¸ë³´ê¸°">ğŸ‘ï¸</button>
                    <button onclick="editUser('${user.docId}')" 
                            class="btn btn-sm" title="ìˆ˜ì •">âœï¸</button>
                    <button onclick="deleteUser('${user.docId}')" 
                            class="btn btn-red btn-sm" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                `}
            </div>
        </td>
    </tr>
`).join('');
            }

            getStatusLabel(status) {
                const labels = {
                    active: 'í™œì„±',
                    pending: 'ìŠ¹ì¸ëŒ€ê¸°',
                    suspended: 'ì •ì§€'
                };
                return labels[status] || status;
            }

            renderPagination() {
                const pagination = document.getElementById('usersPagination');
                if (!pagination) return;

                const { currentPage, totalPages, totalItems, itemsPerPage } = this.pagination;
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                const startItem = (currentPage - 1) * itemsPerPage + 1;
                const endItem = Math.min(currentPage * itemsPerPage, totalItems);

                let paginationHTML = `
                    <button class="pagination-btn" 
                            onclick="window.usersManager.goToPage(${currentPage - 1})"
                            ${currentPage === 1 ? 'disabled' : ''}>
                        â—€ ì´ì „
                    </button>
                `;

                // í˜ì´ì§€ ë²ˆí˜¸ë“¤
                const maxVisiblePages = 5;
                let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }

                for (let i = startPage; i <= endPage; i++) {
                    paginationHTML += `
                        <button class="pagination-btn ${i === currentPage ? 'active' : ''}"
                                onclick="window.usersManager.goToPage(${i})">
                            ${i}
                        </button>
                    `;
                }

                paginationHTML += `
                    <button class="pagination-btn" 
                            onclick="window.usersManager.goToPage(${currentPage + 1})"
                            ${currentPage === totalPages ? 'disabled' : ''}>
                        ë‹¤ìŒ â–¶
                    </button>
                    <div class="pagination-info" style="margin-left: 1rem; color: #6b7280;">
                        ${startItem}-${endItem} / ${totalItems}ê°œ
                    </div>
                `;

                pagination.innerHTML = paginationHTML;
            }

            goToPage(page) {
                if (page < 1 || page > this.pagination.totalPages) return;
                this.pagination.currentPage = page;
                this.loadUsers();
            }

            setupEventListeners() {
                // ê²€ìƒ‰ ë° í•„í„°
                document.getElementById('userSearch')?.addEventListener('input', (e) => {
                    this.filters.search = e.target.value;
                    this.pagination.currentPage = 1;
                    this.loadUsers();
                });

                document.getElementById('roleFilter')?.addEventListener('change', (e) => {
                    this.filters.role = e.target.value;
                    this.pagination.currentPage = 1;
                    this.loadUsers();
                });

                document.getElementById('statusFilter')?.addEventListener('change', (e) => {
                    this.filters.status = e.target.value;
                    this.pagination.currentPage = 1;
                    this.loadUsers();
                });

                document.getElementById('branchFilter')?.addEventListener('change', (e) => {
                    this.filters.branch = e.target.value;
                    this.pagination.currentPage = 1;
                    this.loadUsers();
                });
// ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í¼
document.getElementById('changePasswordForm')?.addEventListener('submit', (e) => {
    e.preventDefault();
    this.handleChangePassword();
});
                // ì—­í•  ì„ íƒì— ë”°ë¥¸ ì§€ì  ì„ íƒ í‘œì‹œ/ìˆ¨ê¹€
                document.getElementById('userRole')?.addEventListener('change', (e) => {
                    const branchGroup = document.getElementById('branchSelectGroup');
                    if (e.target.value === 'ì§€ì ê´€ë¦¬ì') {
                        branchGroup.style.display = 'block';
                        document.getElementById('userBranch').required = true;
                    } else {
                        branchGroup.style.display = 'none';
                        document.getElementById('userBranch').required = false;
                    }
                });

                document.getElementById('editUserRole')?.addEventListener('change', (e) => {
                    const branchGroup = document.getElementById('editBranchSelectGroup');
                    if (e.target.value === 'ì§€ì ê´€ë¦¬ì') {
                        branchGroup.style.display = 'block';
                        document.getElementById('editUserBranch').required = true;
                    } else {
                        branchGroup.style.display = 'none';
                        document.getElementById('editUserBranch').required = false;
                    }
                });

                // í¼ ì œì¶œ
                document.getElementById('addUserForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleAddUser();
                });

                document.getElementById('editUserForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleEditUser();
                });
            }

            async handleAddUser() {
                try {
                    const formData = {
                        name: document.getElementById('userName').value,
                        email: document.getElementById('userEmail').value,
                        role: document.getElementById('userRole').value,
                        phone: document.getElementById('userPhone').value || null,
                        notes: document.getElementById('userNotes').value || null,
                        status: 'active',
                        createdAt: new Date().toISOString().split('T')[0]
                    };

                    // ì§€ì ê´€ë¦¬ìì¸ ê²½ìš° ì§€ì  ì •ë³´ ì¶”ê°€
                    if (formData.role === 'ì§€ì ê´€ë¦¬ì') {
                        const selectedBranch = document.getElementById('userBranch').value;
                        if (!selectedBranch) {
                            alert('ì§€ì ê´€ë¦¬ìëŠ” ë‹´ë‹¹ ì§€ì ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.');
                            return;
                        }
                        formData.branch = selectedBranch;
                        
                        // ì§€ì  ì½”ë“œ ì°¾ê¸°
                        const branch = this.data.branches.find(b => b.name === selectedBranch);
                        if (branch) {
                            formData.branchCode = branch.code;
                        }
                    }

                    // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
                    const existingUser = this.data.users.find(u => u.email === formData.email);
                    if (existingUser) {
                        alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
                        return;
                    }

// Firebaseì— ì €ì¥
if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
    const db = firebase.firestore();
    await db.collection('users').doc(formData.email).set(formData);  // ì´ë©”ì¼ì„ ë¬¸ì„œ IDë¡œ ì‚¬ìš©
    
    // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
    await this.loadAllData();
}
                    
                    this.hideAddUser();
                    this.loadUsers();
                    
                    this.showNotification('ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    console.error('ê³„ì • ì¶”ê°€ ì˜¤ë¥˜:', error);
                    this.showNotification('ê³„ì • ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            async handleEditUser() {
                try {
                    const docId = document.getElementById('editUserId').value;
                    const formData = {
                        name: document.getElementById('editUserName').value,
                        email: document.getElementById('editUserEmail').value,
                        role: document.getElementById('editUserRole').value,
                        phone: document.getElementById('editUserPhone').value || null,
                        status: document.getElementById('editUserStatus').value,
                        notes: document.getElementById('editUserNotes').value || null
                    };

                    // ì§€ì ê´€ë¦¬ìì¸ ê²½ìš° ì§€ì  ì •ë³´ ì¶”ê°€
                    if (formData.role === 'ì§€ì ê´€ë¦¬ì') {
                        const selectedBranch = document.getElementById('editUserBranch').value;
                        if (!selectedBranch) {
                            alert('ì§€ì ê´€ë¦¬ìëŠ” ë‹´ë‹¹ ì§€ì ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.');
                            return;
                        }
                        formData.branch = selectedBranch;
                        
                        // ì§€ì  ì½”ë“œ ì°¾ê¸°
                        const branch = this.data.branches.find(b => b.name === selectedBranch);
                        if (branch) {
                            formData.branchCode = branch.code;
                        }
                    } else {
                        formData.branch = null;
                        formData.branchCode = null;
                    }

                    // ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ (ìì‹  ì œì™¸)
                    const existingUser = this.data.users.find(u => 
                        u.email === formData.email && u.docId !== docId);
                    if (existingUser) {
                        alert('ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
                        return;
                    }

                    // Firebaseì—ì„œ ì—…ë°ì´íŠ¸
                    if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                        const db = firebase.firestore();
                        await db.collection('users').doc(docId).update(formData);
                        
                        // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
                        await this.loadAllData();
                    }

                    this.hideEditUser();
                    this.loadUsers();
                    
                    this.showNotification('ê³„ì • ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    console.error('ê³„ì • ìˆ˜ì • ì˜¤ë¥˜:', error);
                    this.showNotification('ê³„ì • ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            async approveUser(docId) {
                try {
                    const user = this.data.users.find(u => u.docId === docId);
                    if (!user) return;

                    if (confirm(`"${user.name}" ê³„ì •ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        const updateData = {
                            status: 'active',
                            approvedBy: this.currentUser.id || this.currentUser.email,
                            approvedAt: new Date().toISOString()
                        };

                        if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                            const db = firebase.firestore();
                            await db.collection('users').doc(docId).update(updateData);
                            
                            await this.loadAllData();
                        }
                        
                        this.loadUsers();
                        this.showNotification('ê³„ì •ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    }
                } catch (error) {
                    console.error('ê³„ì • ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                    this.showNotification('ê³„ì • ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            async rejectUser(docId) {
                try {
                    const user = this.data.users.find(u => u.docId === docId);
                    if (!user) return;

                    if (confirm(`"${user.name}" ê³„ì •ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê³„ì •ì´ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                        if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                            const db = firebase.firestore();
                            await db.collection('users').doc(docId).delete();
                            
                            await this.loadAllData();
                        }
                        
                        this.loadUsers();
                        this.showNotification('ê³„ì •ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    }
                } catch (error) {
                    console.error('ê³„ì • ê±°ë¶€ ì˜¤ë¥˜:', error);
                    this.showNotification('ê³„ì • ê±°ë¶€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            async deleteUser(docId) {
                try {
                    const user = this.data.users.find(u => u.docId === docId);
                    if (!user) return;

                    if (confirm(`ì •ë§ë¡œ "${user.name}" ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                            const db = firebase.firestore();
                            await db.collection('users').doc(docId).delete();
                            
                            await this.loadAllData();
                        }
                        
                        this.loadUsers();
                        this.showNotification('ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    }
                } catch (error) {
                    console.error('ê³„ì • ì‚­ì œ ì˜¤ë¥˜:', error);
                    this.showNotification('ê³„ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }

            showAddUser() {
                document.getElementById('addUserModal').classList.remove('hidden');
            }

            hideAddUser() {
                document.getElementById('addUserModal').classList.add('hidden');
                document.getElementById('addUserForm').reset();
                document.getElementById('branchSelectGroup').style.display = 'none';
            }

            showEditUser(docId) {
                const user = this.data.users.find(u => u.docId === docId);
                if (!user) return;

                document.getElementById('editUserId').value = user.docId;
                document.getElementById('editUserName').value = user.name;
                document.getElementById('editUserEmail').value = user.email;
                document.getElementById('editUserRole').value = user.role;
                document.getElementById('editUserPhone').value = user.phone || '';
                document.getElementById('editUserStatus').value = user.status;
                document.getElementById('editUserNotes').value = user.notes || '';

                // ì§€ì  ì„ íƒ í‘œì‹œ/ìˆ¨ê¹€
                const branchGroup = document.getElementById('editBranchSelectGroup');
                if (user.role === 'ì§€ì ê´€ë¦¬ì') {
                    branchGroup.style.display = 'block';
                    document.getElementById('editUserBranch').value = user.branch || '';
                } else {
                    branchGroup.style.display = 'none';
                }
                
                document.getElementById('editUserModal').classList.remove('hidden');
            }

            hideEditUser() {
                document.getElementById('editUserModal').classList.add('hidden');
                document.getElementById('editUserForm').reset();
            }

            showViewUser(docId) {
                const user = this.data.users.find(u => u.docId === docId);
                if (!user) return;

                const detailHTML = `
                    <div class="user-detail-grid">
                        <div class="detail-section">
                            <h4>ğŸ‘¤ ê¸°ë³¸ ì •ë³´</h4>
                            <div class="detail-item">
                                <span class="detail-label">ì´ë¦„</span>
                                <span class="detail-value">${user.name}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ì´ë©”ì¼</span>
                                <span class="detail-value">${user.email}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ì „í™”ë²ˆí˜¸</span>
                                <span class="detail-value">${user.phone || '-'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ì—­í• </span>
                                <span class="detail-value">
                                    <span class="user-role role-${user.role === 'ì „ì²´ê´€ë¦¬ì' ? 'admin' : 'manager'}">
                                        ${user.role}
                                    </span>
                                </span>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4>ğŸ¢ ì§€ì  ì •ë³´</h4>
                            <div class="detail-item">
                                <span class="detail-label">ë‹´ë‹¹ ì§€ì </span>
                                <span class="detail-value">${user.branch || '-'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ì§€ì  ì½”ë“œ</span>
                                <span class="detail-value">${user.branchCode || '-'}</span>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4>ğŸ“Š ê³„ì • ìƒíƒœ</h4>
                            <div class="detail-item">
                                <span class="detail-label">ìƒíƒœ</span>
                                <span class="detail-value">
                                    <span class="user-status status-${user.status}">
                                        ${this.getStatusLabel(user.status)}
                                    </span>
                                </span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ê°€ì…ì¼</span>
                                <span class="detail-value">${user.createdAt}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ìµœê·¼ ë¡œê·¸ì¸</span>
                                <span class="detail-value">${user.lastLogin || '-'}</span>
                            </div>
                            ${user.approvedBy ? `
                                <div class="detail-item">
                                    <span class="detail-label">ìŠ¹ì¸ì</span>
                                    <span class="detail-value">${user.approvedBy}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ìŠ¹ì¸ì¼</span>
                                    <span class="detail-value">${user.approvedAt}</span>
                                </div>
                            ` : ''}
                        </div>

                        ${user.notes ? `
                            <div class="detail-section">
                                <h4>ğŸ“ ë©”ëª¨</h4>
                                <p>${user.notes}</p>
                            </div>
                        ` : ''}
                    </div>
                `;

                document.getElementById('userDetailContent').innerHTML = detailHTML;
                document.getElementById('viewUserModal').classList.remove('hidden');
            }

            hideViewUser() {
                document.getElementById('viewUserModal').classList.add('hidden');
            }

            exportUsers() {
                const users = [...this.data.users];
                
                let csvContent = "\ufeffì´ë¦„,ì´ë©”ì¼,ì—­í• ,ë‹´ë‹¹ì§€ì ,ìƒíƒœ,ì „í™”ë²ˆí˜¸,ê°€ì…ì¼,ìµœê·¼ë¡œê·¸ì¸\n";
                
                users.forEach(u => {
                    csvContent += `${u.name},${u.email},${u.role},"${u.branch || ''}",${this.getStatusLabel(u.status)},${u.phone || ''},${u.createdAt},${u.lastLogin || ''}\n`;
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `GOHAIR_ê³„ì •ëª©ë¡_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            showNotification(message, type = 'info') {
                if (window.showNotification) {
                    window.showNotification(message, type);
                } else {
                    alert(message);
                }
            }
            showNotification(message, type = 'info') {
                if (window.showNotification) {
                    window.showNotification(message, type);
                } else {
                    alert(message);
                }
            }

            // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê´€ë ¨ ë©”ì„œë“œë“¤ â† ì—¬ê¸°ì— ì¶”ê°€!
            showChangePassword(docId) {
                const user = this.data.users.find(u => u.docId === docId);
                if (!user) return;

                document.getElementById('changePasswordUserId').value = user.docId;
                document.getElementById('changePasswordUserName').value = user.name + ' (' + user.email + ')';
                document.getElementById('newPassword').value = '';
                document.getElementById('newPasswordConfirm').value = '';
                document.getElementById('newPasswordMatchMessage').innerHTML = '';
                
                // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ê²€ì¦ ì´ë²¤íŠ¸ ì¶”ê°€
                const newPassword = document.getElementById('newPassword');
                const newPasswordConfirm = document.getElementById('newPasswordConfirm');
                const matchMessage = document.getElementById('newPasswordMatchMessage');
                
                function checkMatch() {
                    if (newPasswordConfirm.value.length > 0) {
                        if (newPassword.value === newPasswordConfirm.value) {
                            matchMessage.innerHTML = 'âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.';
                            matchMessage.style.color = '#059669';
                        } else {
                            matchMessage.innerHTML = 'âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                            matchMessage.style.color = '#dc2626';
                        }
                    } else {
                        matchMessage.innerHTML = '';
                    }
                }
                
                newPassword.addEventListener('input', checkMatch);
                newPasswordConfirm.addEventListener('input', checkMatch);
                
                document.getElementById('changePasswordModal').classList.remove('hidden');
            }

            hideChangePassword() {
                document.getElementById('changePasswordModal').classList.add('hidden');
                document.getElementById('changePasswordForm').reset();
            }

            async handleChangePassword() {
                try {
                    const docId = document.getElementById('changePasswordUserId').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const newPasswordConfirm = document.getElementById('newPasswordConfirm').value;
                    
                    if (newPassword !== newPasswordConfirm) {
                        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    if (newPassword.length < 6) {
                        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                        return;
                    }
                    
                    const user = this.data.users.find(u => u.docId === docId);
                    if (!user) return;
                    
                    if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
                        const db = firebase.firestore();
                        await db.collection('users').doc(docId).update({
                            password: newPassword
                        });
                        
                        await this.loadAllData();
                    }
                    
                    this.hideChangePassword();
                    this.loadUsers();
                    
                    this.showNotification('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
                    this.showNotification('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        } â† UsersManager í´ë˜ìŠ¤ ë

        // ì „ì—­ í•¨ìˆ˜ë“¤
        function showAddUser() { window.usersManager?.showAddUser(); }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        function showAddUser() { window.usersManager?.showAddUser(); }
        function hideAddUser() { window.usersManager?.hideAddUser(); }
        function editUser(docId) { window.usersManager?.showEditUser(docId); }
        function hideEditUser() { window.usersManager?.hideEditUser(); }
        function viewUser(docId) { window.usersManager?.showViewUser(docId); }
        function hideViewUser() { window.usersManager?.hideViewUser(); }
        function deleteUser(docId) { window.usersManager?.deleteUser(docId); }
        function approveUser(docId) { window.usersManager?.approveUser(docId); }
        function rejectUser(docId) { window.usersManager?.rejectUser(docId); }
        function exportUsers() { window.usersManager?.exportUsers(); }
    function changePassword(docId) { window.usersManager?.showChangePassword(docId); }
        function hideChangePassword() { window.usersManager?.hideChangePassword(); }
        function goToMainSystem() { window.location.href = '../index.html'; }
        function goToPage(pageId) {
            const pages = {
                'designers': 'designers.html',
                'branches': 'branches.html',
                'users': 'users.html',
                'history': 'history.html',
                'checklist': 'checklist.html', 
                'statistics': 'statistics.html',
                'comparison': 'comparison.html'
            };
            if (pages[pageId]) {
                window.location.href = pages[pageId];
            }
        }

// ë‹¨ì¼ ì´ˆê¸°í™” í•¨ìˆ˜
function initializeUsersPage() {
    console.log('ğŸ‘¤ Users í˜ì´ì§€ ì´ˆê¸°í™” ì‹œì‘');
    
    // ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸
    if (!window.navigationManager) {
        console.warn('âš ï¸ ë„¤ë¹„ê²Œì´ì…˜ì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•ŠìŒ');
        return;
    }
    
    try {
        // í•„í„° ë§¤ë‹ˆì € ì´ˆê¸°í™”
        if (typeof initializePageFilters === 'function') {
            initializePageFilters();
        }
        
        // í˜ì´ì§€ ë§¤ë‹ˆì € ì´ˆê¸°í™”
        if (typeof UsersManager !== 'undefined') {
            window.usersManager = new UsersManager();
            window.usersManager.initialize();
        }
        
        console.log('âœ… Users í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
    } catch (error) {
        console.error('âŒ í˜ì´ì§€ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
    }
}

// DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        // ë„¤ë¹„ê²Œì´ì…˜ ë¡œë“œë¥¼ ê¸°ë‹¤ë¦° í›„ í˜ì´ì§€ ì´ˆê¸°í™”
        setTimeout(initializeUsersPage, 500);
    });
} else {
    setTimeout(initializeUsersPage, 100);
}
    </script>
</body>
</html>
